<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CTOF ‚Äî Communaut√© des Togolais de Ferrara</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      /* ===== Palette Togo ‚Äî Style A (Togo Pro Lumineux) ===== */
      :root {
        --togo-green: #006a4e;
        --togo-yellow: #ffce00;
        --togo-red: #d40000;
        --bg: #fbfbfa;
        --card: #f3f0f0;
        --muted: #6b7280;
        --accent: #0b66c2;
        --radius: 14px;
        --maxw: 1200px;
      }

      /* Reset & base */
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
        background: linear-gradient(180deg, var(--bg), #f7f7f5);
        color: #0f1724;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        line-height: 1.5;
      }

      a {
        color: var(--togo-green);
        text-decoration: none;
      }
      img {
        max-width: 100%;
        display: block;
      }

      /* Header */
      .site-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 18px 4%;
        background: var(--togo-green);
        color: var(--card);
        position: sticky;
        top: 0;
        z-index: 80;
        box-shadow: 0 6px 18px rgba(2, 6, 23, 0.08);
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo {
        height: 56px;
        width: 56px;
        border-radius: 10px;
        object-fit: cover;
        border: 2px solid rgba(255, 255, 255, 0.61);
      }
      .title {
        font-weight: 700;
        font-size: 1rem;
      }
      nav#mainNav {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      nav a {
        color: rgba(255, 255, 255, 0.95);
        padding: 8px 12px;
        border-radius: 10px;
        font-weight: 600;
      }
      .nav-cta {
        background: var(--togo-yellow);
        color: var(--togo-green);
        padding: 8px 12px;
        border-radius: 10px;
        font-weight: 700;
      }

      .lang-switch {
        display: flex;
        gap: 8px;
      }
      .lang-btn {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.95);
        padding: 6px 8px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
      }

      .burger {
        display: none;
        background: transparent;
        border: 0;
        color: var(--card);
        font-size: 20px;
      }

      /* Main container */
      main {
        max-width: var(--maxw);
        margin: 28px auto;
        padding: 0 20px;
      }

      /* Hero / Marquee */
      .hero {
        border-radius: 18px;
        padding: 28px 26px;
        background: linear-gradient(
          90deg,
          var(--togo-green) 0%,
          var(--togo-yellow) 100%
        );
        color: var(--card);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        box-shadow: 0 10px 30px rgba(11, 102, 78, 0.08);
      }
      .hero .hero-left {
        max-width: 70%;
      }
      .hero h1 {
        margin: 0;
        font-size: 1.6rem;
        font-weight: 800;
        letter-spacing: 0.01em;
      }
      .hero p {
        margin: 8px 0 0;
        color: rgba(255, 255, 255, 0.95);
      }
      .hero .cta {
        background: var(--togo-red);
        color: #ffffff; /* force white text for CTA per request */
        padding: 10px 14px;
        border-radius: 12px;
        border: 0;
        font-weight: 700;
        cursor: pointer;
      }

      .marquee {
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
      }
      .marquee span {
        display: inline-block;
        animation: marq 22s linear infinite;
      }
      @keyframes marq {
        0% {
          transform: translateX(100%);
        }
        100% {
          transform: translateX(-100%);
        }
      }

      /* Section style using Togo format (cards + title-bar) */
      section.section {
        margin: 28px 0;
        padding: 28px;
        background: var(--card);
        border-radius: var(--radius);
        box-shadow: 0 8px 28px rgba(11, 102, 78, 0.04);
      }
      .title-bar {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 18px;
      }
      .title-accent {
        width: 42px;
        height: 10px;
        border-radius: 6px;
        background: var(--togo-red);
      }
      h2.section-title {
        font-size: 1.45rem;
        margin: 0;
      }

      .lead {
        color: var(--muted);
        margin-top: 10px;
      }

      /* Grid layout */
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 18px;
        align-items: start;
      }
      .col-8 {
        grid-column: span 8;
      }
      .col-4 {
        grid-column: span 4;
      }
      @media (max-width: 900px) {
        .col-8,
        .col-4 {
          grid-column: span 12;
        }
      }

      /* Buttons (reused for years filter) */
      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 12px;
      }
      .filters .btn {
        background: #0b6b4f;
        color: #fff;
        padding: 6px 12px;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        cursor: pointer;
      }
      .year-btn {
        background: #0b6b4f;
        color: #fff;
        padding: 6px 12px;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        cursor: pointer;
      }
      .year-btn.ghost {
        background: transparent;
        color: #0b6b4f;
        border: 1px solid rgba(11, 107, 79, 0.12);
      }
      .year-btn.active {
        background: var(--togo-yellow);
        color: var(--togo-green);
        box-shadow: 0 6px 18px rgba(11, 107, 79, 0.08);
      }

      /* Gallery */
      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
      }
      .gallery-item {
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
        border: 1px solid #7a7a78;
      }
      .gallery-item img {
        height: 140px;
        object-fit: cover;
        display: block;
        transition: transform 0.35s ease;
      }

      /* favourite badge for quick gallery */
      .fav-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.92);
        color: #d40000;
        padding: 4px 6px;
        border-radius: 10px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 6px 14px rgba(2, 6, 23, 0.12);
        z-index: 5;
      }
      .fav-badge i { color: gold; }

      /* ---- Correctif pour galerie : faire occuper enti√®rement le cadre ---- */

      /* conteneur : taille contr√¥l√©e, coins arrondis, masque l'overflow */
      .gallery-item {
        position: relative; /* pour positionnement de l'image */
        overflow: hidden; /* masque les d√©bordements */
        border-radius: 12px;
        background: #f6f6f6; /* fallback visible si image lente √† charger */
        display: block;
        /* hauteur fixe pour miniatures ‚Äî ajustez selon vos besoins */
        height: 140px; /* taille utilis√©e partout ; changez pour fullGallery si n√©cessaire */
      }

      /* image : remplir tout le conteneur, conserver ratio et qualit√© */
      .gallery-item img {
        position: absolute;
        inset: 0; /* top:0; right:0; bottom:0; left:0; */
        width: 100%;
        height: 100%;
        object-fit: cover; /* remplit le conteneur sans d√©former */
        object-position: center; /* centre l'image (changez si besoin : top / left / 10% 20% ) */
        display: block;
        -webkit-backface-visibility: hidden; /* petites optimisations pour rendu */
        backface-visibility: hidden;
      }

      /* si vous avez une galerie "pleine largeur" avec carr√©s, donnez-lui un aspect-ratio */
      #fullGallery .gallery-item {
        height: auto;
        aspect-ratio: 1 / 1; /* carr√©s ; changez en 4/3 ou autre si vous pr√©f√©rez */
        min-height: 160px;
      }

      /* pour la galerie rapide (sidebar), on souhaite des miniatures plus hautes */
      #galleryGrid .gallery-item {
        height: 150px; /* exemple pour la colonne de droite (r√©duisez/augmentez) */
      }

      /* important : annulez max-height/height contradictoires sur les images ailleurs */
      .gallery-item img[style] {
        /* cas o√π un style inline existe */
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
      }

      .gallery-item:hover img {
        transform: scale(1.04);
      }
      .view-all {
        display: inline-block;
        margin-top: 12px;
        padding: 8px 12px;
        border-radius: 10px;
        background: var(--togo-yellow);
        color: var(--togo-green);
        font-weight: 700;
      }

      /* fullGallery container: uses year buttons above */
      #galleryYears {
        margin-bottom: 10px;
      }

      /* ensure larger gallery view still shows compact tiles grouped by year */
      #fullGallery .album-section {
        margin-bottom: 18px;
      }
      #fullGallery .album-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 8px;
      }
      #fullGallery .album-title h3 {
        margin: 0;
        font-size: 1.1rem;
      }
      #fullGallery .album-count {
        color: var(--muted);
        font-size: 0.95rem;
      }

      /* Lightbox */
      .lightbox {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        z-index: 200;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
      }
      .lightbox.open {
        opacity: 1;
        pointer-events: auto;
      }
      .lightbox img {
        max-width: 92%;
        max-height: 86%;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.6);
      }

      /* Documents */
      .docs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 14px;
      }
      .doc-card {
        background: linear-gradient(180deg, var(--card), #e9e6e6);
        padding: 16px;
        border-radius: 12px;
        border: 1px solid #6e6e6b;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .doc-card h4 {
        margin: 0;
        font-size: 1rem;
      }
      .doc-card small {
        color: var(--muted);
        display: block;
        margin-top: 6px;
      }
      .doc-actions .btn {
        background: var(--togo-green);
        color: #fff;
        padding: 8px 12px;
        border-radius: 10px;
        font-weight: 700;
        border: 0;
      }

      /* Events */
      .events-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 12px;
      }
      .event {
        padding: 14px;
        border-radius: 12px;
        background: linear-gradient(180deg, #e4e1e1, #cac5b3);
        border: 1px solid #61605f;
      }

      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 12px;
      }

      .btn {
        padding: 8px 12px;
        border-radius: 10px;
        border: 0;
        background: var(--togo-green);
        font-weight: 700;
        cursor: pointer;
        color: #fff; /* ensure white text on all .btn per request */
      }
      .btn.primary {
        background: var(--togo-green);
        color: white;
      }

      /* Videos */
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 12px;
      }
      .video-grid iframe {
        width: 100%;
        height: 210px;
        border-radius: 12px;
        border: 0;
      }

      /* FAQ */
      .hidden {
        display: none;
      }
      #faq-section {
        margin: 18px 0;
      }
      #toggle-faq {
        display: inline-block;
        padding: 10px 14px;
        border-radius: 12px;
        background: var(--togo-yellow);
        color: var(--togo-green);
        font-weight: 700;
        border: 0;
        cursor: pointer;
      }
      .faq-item {
        margin-top: 12px;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid #ddd;
        background: #fff;
      }
      .faq-question {
        width: 100%;
        text-align: left;
        padding: 12px;
        background: #f7f7f7;
        border: 0;
        font-weight: 700;
        cursor: pointer;
      }
      .faq-answer {
        padding: 12px;
        display: none;
      }
      .faq-answer.open {
        display: block;
      }

      /* Admin panel (local) */
      #admin-panel {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 360px;
        max-width: calc(100% - 40px);
        z-index: 220;
        display: none;
      }
      #admin-panel.open {
        display: block;
      }
      .admin-card {
        background: var(--card);
        padding: 14px;
        border-radius: 12px;
        box-shadow: 0 12px 30px rgba(2, 6, 23, 0.12);
      }
      input[type="text"],
      input[type="password"],
      input[type="date"],
      textarea {
        width: 100%;
        padding: 8px;
        border-radius: 10px;
        border: 1px solid #e8e2c8;
      }
      textarea {
        min-height: 80px;
      }
      .admin-row {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }

      /* Map */
      .map {
        height: 320px;
        border-radius: 12px;
        border: 1px solid #f0ead6;
        overflow: hidden;
      }

      /* Footer */
      footer {
        padding: 20px 4%;
        text-align: center;
        background: linear-gradient(90deg, var(--togo-green), #004c3a);
        color: var(--card);
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        margin-top: 28px;
      }

      /* Responsive header collapse */
      @media (max-width: 880px) {
        nav#mainNav {
          display: none;
          position: absolute;
          top: 68px;
          left: 0;
          right: 0;
          background: var(--togo-green);
          padding: 12px 16px;
          flex-direction: column;
          gap: 8px;
        }
        .burger {
          display: block;
        }
      }

      /* small helpers */
      .muted {
        color: var(--muted);
      }
      .card {
        background: var(--card);
        padding: 14px;
        border-radius: 12px;
      }

      /* ensure events nav item is clearly white */
      a.nav-events {
        color: #ffffff !important;
        background: rgba(255, 255, 255, 0.06);
        padding: 8px 12px;
        border-radius: 10px;
      }

      /* admin events list */
      .admin-events {
        margin-top: 10px;
        max-height: 160px;
        overflow: auto;
        border-top: 1px dashed #ddd;
        padding-top: 8px;
        gap: 8px;
      }
      .admin-event-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 6px 0;
        border-bottom: 1px solid #eee;
      }
      .small-btn {
        padding: 6px 8px;
        border-radius: 8px;
        background: #444;
        color: #fff;
        font-weight: 700;
        border: 0;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <img class="logo" src="images/logo-ctof.jpg" alt="CTOF logo" />
        <div>
          <div
            class="title lang"
            data-key="site_title"
            data-fr="COMMUNAUT√â DES TOGOLAIS DE FERRARA"
            data-it="COMUNIT√Ä DEI TOGOLESI DI FERRARA"
          >
            COMMUNAUT√â DES TOGOLAIS DE FERRARA
          </div>
          <div
            id="headerSubtitle"
            class="muted header-sub"
            style="font-size: 12px; color: #fff; opacity: 0.95"
            data-key="header_subtitle"
            data-fr="Association culturelle & solidaire"
            data-it="Associazione culturale e solidale"
          >
            Association culturelle & solidaire
          </div>
        </div>
      </div>

      <nav id="mainNav">
        <a
          href="#about"
          class="nav-link"
          data-key="nav_home"
          data-fr="Accueil"
          data-it="Home"
          >Accueil</a
        >
        <a
          href="#gallery"
          class="nav-link"
          data-key="nav_gallery"
          data-fr="Galerie"
          data-it="Galleria"
          >Galerie</a
        >
        <a
          href="#documents"
          class="nav-link"
          data-key="nav_docs"
          data-fr="Documents"
          data-it="Documenti"
          >Documents</a
        >
        <a
          href="#events"
          class="nav-link nav-events"
          data-key="nav_events"
          data-fr="√âv√©nements"
          data-it="Eventi"
          >√âv√©nements</a
        >
        <a
          href="#map"
          class="nav-link"
          data-key="nav_address"
          data-fr="Adresse"
          data-it="Indirizzo"
          >Adresse</a
        >
        <button
          id="open-admin"
          title="Admin"
          class="nav-cta"
          data-key="nav_admin"
          data-fr="Admin"
          data-it="Admin"
          type="button"
        >
          Admin
        </button>
      </nav>

      <div style="display: flex; align-items: center; gap: 8px">
        <div class="lang-switch" aria-hidden="false">
          <button class="lang-btn" data-lang="fr" type="button">FR</button>
          <button class="lang-btn" data-lang="it" type="button">IT</button>
        </div>
        <button class="burger" id="burger" aria-label="menu" type="button">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </header>

    <main>
      <!-- HERO + MARQUEE -->
      <section class="hero" aria-labelledby="hero-title">
        <div class="hero-left">
          <h1
            id="hero-title"
            class="lang"
            data-key="hero_title"
            data-fr="Bienvenue √† la CTOF"
            data-it="Benvenuti alla CTOF"
          >
            Bienvenue √† la CTOF
          </h1>
          <p
            class="lang lead"
            data-key="hero_sub"
            data-fr="Association togolaise √† Ferrara ‚Äî culture, entraide et √©v√©nements communautaires."
            data-it="Associazione togolese a Ferrara ‚Äî cultura, solidariet√† ed eventi."
          >
            Association togolaise √† Ferrara ‚Äî culture, entraide et √©v√©nements
            communautaires.
          </p>
          <div style="margin-top: 12px">
            <!-- Changed: button is now translatable via data-key="hero_cta" -->
            <button
              class="cta lang"
              data-key="hero_cta"
              onclick="location.href='#events'"
              type="button"
            >
              Voir les √©v√©nements
            </button>
          </div>
        </div>

        <div style="min-width: 320px; text-align: right">
          <div class="marquee" aria-hidden="true">
            <span
              class="lang"
              data-fr="üèõÔ∏è Assembl√©e G√©n√©rale ‚Äì Septembre 2025  ¬∑  ü§ù Rencontre CTOF & ASTOF  ¬∑  üéâ F√™tes de fin d‚Äôann√©e  ¬∑  üì£ Ind√©pendance du Togo ‚Äì 27 Avril 2026"
              data-it="üèõÔ∏è Assemblea Generale ‚Äì Settembre 2025  ¬∑  ü§ù Incontro CTOF & ASTOF  ¬∑  üéâ Feste di fine anno  ¬∑  üì£ Indipendenza del Togo ‚Äì 27 Aprile 2026"
              >üèõÔ∏è Assembl√©e G√©n√©rale ‚Äì Septembre 2025 ¬∑ ü§ù Rencontre CTOF &
              ASTOF ¬∑ üéâ F√™tes de fin d‚Äôann√©e ¬∑ üì£ Ind√©pendance du Togo ‚Äì 27
              Avril 2026</span
            >
          </div>
        </div>
      </section>

      <!-- ABOUT + Documents + Events -->
      <section class="section grid" id="about" aria-labelledby="about-title">
        <div class="col-8">
          <div class="card">
            <div class="title-bar">
              <div class="title-accent"></div>
              <h2
                class="section-title lang"
                id="about-title"
                data-key="about"
                data-fr="√Ä PROPOS DE CTOF"
                data-it="CHI SIAMO"
              >
                √Ä PROPOS DE CTOF
              </h2>
            </div>
            <p
              class="lead lang"
              data-key="about_text"
              data-fr="L‚Äôassociation CTOF promeut la culture togolaise et favorise l‚Äôint√©gration √† Ferrara. Nous organisons √©v√©nements, actions solidaires et ateliers pour la communaut√©."
              data-it="L'associazione CTOF promuove la cultura togolese e favorisce l'integrazione a Ferrara. Organizziamo eventi, azioni solidali e workshop per la comunit√†."
            >
              L‚Äôassociation CTOF promeut la culture togolaise et favorise
              l‚Äôint√©gration √† Ferrara. Nous organisons √©v√©nements, actions
              solidaires et ateliers pour la communaut√©.
            </p>
          </div>

          <div style="margin-top: 18px" class="card">
            <div class="title-bar">
              <div class="title-accent"></div>
              <h2
                class="section-title lang"
                data-key="documents"
                data-fr="DOCUMENTS OFFICIELS"
                data-it="DOCUMENTI UFFICIALI"
              >
                DOCUMENTS OFFICIELS
              </h2>
            </div>
            <div class="docs-grid" id="docsGrid">
              <!-- documents injected by JS -->
            </div>
          </div>

          <div
            style="margin-top: 18px"
            class="card"
            id="events"
            aria-labelledby="events-title"
          >
            <div class="title-bar">
              <div class="title-accent"></div>
              <h2
                class="section-title lang"
                id="events-title"
                data-key="events"
                data-fr="√âV√âNEMENTS"
                data-it="EVENTI"
              >
                √âV√âNEMENTS
              </h2>
            </div>

            <div class="filters" style="margin-bottom: 12px">
              <button
                class="btn lang"
                data-filter="all"
                data-key="filter_all"
                data-fr="Tous"
                data-it="Tutti"
                type="button"
              >
                Tous
              </button>
              <button
                class="btn lang"
                data-filter="upcoming"
                data-key="filter_upcoming"
                data-fr="√Ä venir"
                data-it="In arrivo"
                type="button"
              >
                √Ä venir
              </button>
              <button
                class="btn lang"
                data-filter="past"
                data-key="filter_past"
                data-fr="Pass√©s"
                data-it="Passati"
                type="button"
              >
                Pass√©s
              </button>
            </div>

            <div class="events-list" id="eventsList"></div>
          </div>
        </div>

        <aside class="col-4">
          <div class="card">
            <div class="title-bar">
              <div class="title-accent"></div>
              <h3
                class="section-title lang"
                data-key="quick_gallery"
                data-fr="Galerie rapide"
                data-it="Galleria rapida"
              >
                Galerie rapide
              </h3>
            </div>
            <div class="gallery-grid" id="galleryGrid"></div>
            <div style="text-align: center">
              <a
                class="view-all"
                href="#gallery"
                data-key="view_all"
                data-fr="Voir toute la galerie"
                data-it="Vedi tutta la galleria"
                >Voir toute la galerie</a
              >
            </div>
          </div>

          <div class="card" style="margin-top: 16px">
            <div class="title-bar">
              <div class="title-accent"></div>
              <h3
                class="section-title lang"
                data-key="contact"
                data-fr="Contact"
                data-it="Contatti"
              >
                Contact
            </h3>
</div>
<p class="muted">
  Email:
  <a href="mailto:comunitactof@gmail.com">comunitactof@gmail.com</a><br />
  Pec:
  <a href="mailto:comunitactofpec@spidmail.it">comunitactofpec@spidmail.it</a><br />
  Tel: +39 379 282 0509
</p>
            <div style="margin-top: 8px">
            <div style="margin-top: 8px">
              <a
                href="https://www.facebook.com/share/1EHa35tQ8t/"
                target="_blank"
                aria-label="facebook"
                ><i class="fab fa-facebook fa-lg" style="margin-right: 10px"></i
              ></a>
              <a
                href="https://www.instagram.com/ctof_ferrara?igsh=OXczaXFkOHEzYjNn"
                target="_blank"
                aria-label="instagram"
                ><i class="fab fa-instagram fa-lg"></i
              ></a>
            </div>
          </div>

          <div class="card" style="margin-top: 16px">
            <div class="title-bar">
              <div class="title-accent"></div>
              <h3
                class="section-title lang"
                data-key="useful"
                data-fr="Infos utiles"
                data-it="Info utili"
              >
                Infos utiles
              </h3>
            </div>
            <ul style="padding-left: 18px; margin: 0; color: var(--muted)">
              <li>
                <a href="https://www.republicoftogo.com/" target="_blank"
                  >üì∞ Republic of Togo</a
                >
              </li>
              <li>
                <a href="https://www.rfi.fr/fr/tag/togo/" target="_blank"
                  >üìª RFI - Togo</a
                >
              </li>
              <li>
                <a href="https://www.lanuovaferrara.it/" target="_blank"
                  >üì∞ La Nuova Ferrara</a
                >
              </li>
              <li>
                <a href="https://www.repubblica.it/" target="_blank"
                  >üì∞ La Repubblica</a
                >
              </li>
              <li>
                <a href="https://www.ansa.it/" target="_blank">üóûÔ∏è ANSA</a>
              </li>
              <li>
                <a href="https://tg24.sky.it/" target="_blank">üì∫ Sky TG24</a>
              </li>
              <li>
                <a href="https://fr.wikipedia.org/wiki/Togo" target="_blank"
                  >üìö Wikip√©dia (FR)</a
                >
              </li>
              <li>
                <a href="https://it.wikipedia.org/wiki/Togo" target="_blank"
                  >üìö Wikipedia (IT)</a
                >
              </li>
            </ul>
          </div>
        </aside>
      </section>

      <!-- Full gallery -->
      <section id="gallery" class="section">
        <div class="title-bar">
          <div class="title-accent"></div>
          <h2
            class="section-title lang"
            data-key="gallery"
            data-fr="GALERIE"
            data-it="GALLERIA"
          >
            GALERIE
          </h2>
        </div>

        <!-- Year buttons will be rendered here -->
        <div id="galleryYears" class="filters" aria-hidden="false"></div>

        <!-- Albums / photos -->
        <div id="fullGallery"></div>
      </section>

      <!-- Videos -->
      <section class="section card">
        <div class="title-bar">
          <div class="title-accent"></div>
          <h2
            class="section-title lang"
            data-key="videos"
            data-fr="VID√âOS"
            data-it="VIDEO"
          >
            VID√âOS
          </h2>
        </div>
        <div class="video-grid">
          <iframe
            src="https://www.youtube.com/embed/UjwyLjAG_Js"
            title="Video 1"
            loading="lazy"
          ></iframe>
          <iframe
            src="https://www.youtube.com/embed/OzX-Fhriq4c"
            title="Video 2"
            loading="lazy"
          ></iframe>
        </div>
      </section>

      <!-- FAQ section inserted between Videos and Map -->
      <section id="faq-section" class="section card">
        <div class="title-bar">
          <div class="title-accent"></div>
          <h2
            class="section-title lang"
            data-key="faq_title"
            data-fr="FAQ ‚Äì Questions fr√©quentes"
            data-it="FAQ ‚Äì Domande frequenti"
          >
            FAQ ‚Äì Questions fr√©quentes
          </h2>
        </div>

        <div style="text-align: center; margin-bottom: 12px">
          <button
            id="toggle-faq"
            class="lang"
            data-fr="üìñ Voir les FAQ"
            data-it="üìñ Visualizza le FAQ"
            type="button"
          >
            üìñ Voir les FAQ
          </button>
        </div>

        <div id="faq" class="hidden">
          <!-- injected by JS -->
        </div>
      </section>

      <!-- Map -->
      <section id="map" class="section" style="padding: 0; overflow: hidden">
        <div style="padding: 18px">
          <div class="title-bar">
            <div class="title-accent"></div>
            <h2
              class="section-title lang"
              data-key="address"
              data-fr="O√ô NOUS TROUVER"
              data-it="DOVE SIAMO"
            >
              O√ô NOUS TROUVER
            </h2>
          </div>
        </div>
        <div class="map">
          <iframe
            width="100%"
            height="100%"
            style="border: 0"
            loading="lazy"
            allowfullscreen
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2803.017970135322!2d11.624708915839295!3d44.83122017909537!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x477eb10e6a0b2b5d%3A0x9ad0eec8c3f5e2c8!2sFerrara!5e0!3m2!1sfr!2sit!4v1600000000000!5m2!1sfr!2sit"
          ></iframe>
        </div>
      </section>
    </main>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
      <img src="" alt="Agrandissement" />
    </div>

    <!-- ADMIN PAGE (plein √©cran) - modified to support uploading photos with year + favorite -->
    <style>
      .admin-page {
        position: fixed;
        inset: 0;
        background: #f7f7f7;
        z-index: 9999;
        display: none;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }
      .admin-page.open {
        display: block;
      }
      .admin-shell {
        max-width: 1100px;
        margin: 18px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.15);
        padding: 18px;
      }
      .admin-grid {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 16px;
        margin-top: 12px;
      }
      @media (max-width: 980px) {
        .admin-grid {
          grid-template-columns: 1fr;
        }
      }
      .meta-row {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 6px;
      }
      .img-meta {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .badge-year {
        background: #eee;
        padding: 4px 8px;
        border-radius: 8px;
        font-size: 12px;
      }
      .fav-star {
        color: gold;
        font-size: 18px;
      }
      .img-item-admin {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 8px 4px;
        border-bottom: 1px solid #f0f0f0;
      }
      .img-item-admin img {
        width: 96px;
        height: 64px;
        object-fit: cover;
        border-radius: 6px;
      }
      .small {
        font-size: 12px;
        color: #666;
      }
    </style>

    <div id="admin-page" class="admin-page" aria-hidden="true">
      <div class="admin-shell" role="main" aria-labelledby="admin-title">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div>
            <h2 id="admin-title">Panneau Admin ‚Äî CTOF</h2>
            <div class="small">
              Espace de gestion : photos, documents, √©v√©nements et textes
            </div>
          </div>
          <div style="display: flex; gap: 8px">
            <button id="admin-save-all" class="btn" type="button">Enregistrer</button>
            <button id="admin-logout" class="btn ghost" type="button">D√©connexion</button>
            <button id="admin-close-page" class="btn ghost" type="button">Retour</button>
          </div>
        </div>

        <div class="admin-grid" style="margin-top: 12px">
          <div>
            <div class="card">
              <h3>Texte du site (bilingue)</h3>
              <label class="small" for="hdr_fr">Sous-titre header (FR)</label>
              <input type="text" id="hdr_fr" placeholder="FR" />
              <label class="small" for="hdr_it" style="margin-top: 6px"
                >Sous-titre header (IT)</label
              >
              <input type="text" id="hdr_it" placeholder="IT" />
            </div>

            <div class="card" style="margin-top: 12px">
              <h3>Galerie ‚Äî images</h3>
              <div class="small">
                Ajoutez des images depuis une URL ou t√©l√©versez des fichiers.
                Pour chaque image vous pouvez d√©finir l'ann√©e (album annuel) et
                la marquer comme "Galerie rapide" (favori).
              </div>

              <div style="margin-top: 8px">
                <input
                  type="text"
                  id="imgUrlInput"
                  placeholder="https://.../photo.jpg"
                />
                <div
                  class="meta-row"
                  style="margin-top: 6px; align-items: center"
                >
                  <label class="small" for="adminDefaultYear">Ann√©e par d√©faut</label>
                  <input
                    type="number"
                    id="adminDefaultYear"
                    min="1900"
                    max="2100"
                    style="width: 110px"
                    placeholder="ex: 2024"
                  />
                  <label style="display: flex; align-items: center; gap: 6px"
                    ><input type="checkbox" id="adminDefaultFav" /> Marquer
                    favori par d√©faut</label
                  >
                  <button id="addImgUrlBtn" class="btn" type="button">Ajouter URL</button>
                </div>

                <div class="meta-row" style="margin-top: 8px">
                  <input
                    type="file"
                    id="imgFileInput"
                    accept="image/*"
                    multiple
                  />
                  <button id="uploadImgFileBtn" class="btn ghost" type="button">
                    T√©l√©verser
                  </button>
                </div>
                <div class="small" style="margin-top:6px;color:var(--muted)">
                  Astuce: √©viter fichiers tr√®s volumineux (>1.5MB) ‚Äî le stockage local peut √™tre limit√©.
                </div>
              </div>

              <div
                id="galleryAdminList"
                style="
                  margin-top: 12px;
                  border-top: 1px solid #eee;
                  max-height: 360px;
                  overflow: auto;
                "
              ></div>
              <div
                style="
                  margin-top: 8px;
                  display: flex;
                  gap: 8px;
                  align-items: center;
                "
              >
                <button id="bulkMarkFavBtn" class="btn" type="button">
                  Marquer s√©lection comme favori
                </button>
                <button id="bulkUnmarkFavBtn" class="btn ghost" type="button">
                  Retirer favoris s√©lection
                </button>
                <button id="bulkDeleteBtn" class="btn danger" type="button">
                  Supprimer s√©lection
                </button>
              </div>
            </div>

            <div class="card" style="margin-top: 12px">
              <h3>Documents officiels</h3>
              <div class="small">
                Ajoutez un document (PDF, DOCX...). Le fichier est encod√© en
                base64 dans localStorage.
              </div>
              <div style="margin-top: 8px">
                <input
                  type="text"
                  id="docTitleInput_fr"
                  placeholder="Titre FR"
                />
                <input
                  type="text"
                  id="docTitleInput_it"
                  placeholder="Titolo IT"
                  style="margin-top: 6px"
                />
                <div class="u-row" style="margin-top: 6px">
                  <input
                    type="text"
                    id="docUrlInput"
                    placeholder="URL (optionnel si fichier upload√©)"
                  />
                  <input
                    type="file"
                    id="docFileInput"
                    accept=".pdf,.doc,.docx,.odt"
                  />
                  <button id="addDocBtn" class="btn" type="button">Ajouter Document</button>
                </div>
                <div class="small" style="margin-top:6px;color:var(--muted)">
                  Limite recommand√©e: fichiers ‚â§ 3MB pour √©viter l'√©puisement du stockage local.
                </div>
              </div>
              <div
                id="docsAdminList"
                style="margin-top: 12px; border-top: 1px solid #eee"
              ></div>
            </div>

            <div class="card" style="margin-top: 12px">
              <h3>√âv√©nements (FR / IT)</h3>
              <input type="text" id="evTitle_fr_admin" placeholder="Titre FR" />
              <input
                type="text"
                id="evTitle_it_admin"
                placeholder="Titolo IT"
                style="margin-top: 6px"
              />
              <input type="date" id="evDate_admin" style="margin-top: 6px" />
              <label class="small" for="evDesc_fr_admin" style="margin-top: 8px"
                >Description FR</label
              >
              <textarea id="evDesc_fr_admin"></textarea>
              <label class="small" for="evDesc_it_admin" style="margin-top: 6px"
                >Description IT</label
              >
              <textarea id="evDesc_it_admin"></textarea>
              <div class="u-row" style="margin-top: 8px">
                <button id="createEvBtn" class="btn" type="button">
                  Cr√©er / Mettre √† jour
                </button>
                <button id="clearEvFormBtn" class="btn ghost" type="button">Annuler</button>
              </div>
              <div
                id="eventsAdminList"
                style="margin-top: 12px; border-top: 1px solid #eee"
              ></div>
            </div>
          </div>

          <aside>
            <div class="card">
              <h3>Aper√ßu rapide</h3>
              <div class="small">Images (vignettes)</div>
              <div
                id="adminThumbs"
                style="
                  margin-top: 8px;
                  display: grid;
                  grid-template-columns: repeat(2, 1fr);
                  gap: 8px;
                "
              ></div>
            </div>

            <div class="card" style="margin-top: 12px">
              <h3>Actions</h3>
              <div class="u-row">
                <button id="saveAndClose" class="btn" type="button">
                  Enregistrer et quitter
                </button>
                <button id="clearLocalBtn" class="btn danger" type="button">
                  R√©initialiser tout
                </button>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>

    <footer>¬© 2025 CTOF ‚Äî Tous droits r√©serv√©s. Con√ßu par l'√©quipe CTOF</footer>

    <!-- ================= SUPABASE (insert BEFORE main app script) =================
         Replace the two placeholders below with your values:
         - SUPABASE_URL: e.g. https://abcd1234.supabase.co
         - SUPABASE_ANON_KEY: the "anon public" key from Supabase project API settings
         DO NOT share these values publicly.
    -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
    <script>
      // Toggle to false if you want to disable remote sync quickly
      const USE_SUPABASE = false;

      // --- PLACE YOUR VALUES HERE ---
      // Replace the placeholders below with your own values (locally only)
      // Example:
      // const SUPABASE_URL = "https://abcd1234.supabase.co";
      // const SUPABASE_ANON_KEY =  "eyJhbGciOi...";
      const SUPABASE_URL = "https://comunita-ctof.supabase.co"; // <-- REPLACE
      const SUPABASE_ANON_KEY = "5U5kXKEwJYDoQnpv1Og-lg_Rjr5-YyW"; // <-- REPLACE
      // -------------------------------------------------------------------------

      let supabaseClient = null;
      if (USE_SUPABASE) {
        try {
          supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } catch (e) {
          console.warn("Supabase client initialization failed:", e);
          supabaseClient = null;
        }
      }

      async function loadRemoteStore() {
        if (!supabaseClient) return null;
        try {
          const { data, error } = await supabaseClient
            .from("site_store")
            .select("data, updated_at")
            .eq("id", 1)
            .single();
          if (error) {
            console.warn("loadRemoteStore error:", error);
            return null;
          }
          return data && data.data ? data.data : null;
        } catch (err) {
          console.error("loadRemoteStore exception:", err);
          return null;
        }
      }

      async function saveRemoteStore(storeObj) {
        if (!supabaseClient) return false;
        try {
          const payload = { id: 1, data: storeObj, updated_at: new Date().toISOString() };
          const { error } = await supabaseClient.from("site_store").upsert(payload, { returning: "minimal" });
          if (error) {
            console.warn("saveRemoteStore error:", error);
            return false;
          }
          return true;
        } catch (err) {
          console.error("saveRemoteStore exception:", err);
          return false;
        }
      }
    </script>

    <script>
      /* ================= Data store (localStorage default) ================= */
      const STORE_KEY = "ctof_data_v2_trans";
      const legacyStoreKey = "ctof_data_v2";

      // default gallery now stores objects with metadata
      const defaultData = {
        lang: localStorage.getItem("ctof_lang") || "fr",
        header_subtitle: {
          fr: "Association culturelle & solidaire",
          it: "Associazione culturale e solidale",
        },
        // gallery entries: { id, url, title, year, is_favorite, created_at }
        gallery: [],
        documents: [
          {
            title: { fr: "Charte CTOF", it: "Carta CTOF" },
            url: "docs/charte.pdf",
          },
          {
            title: { fr: "Dm.de passeport", it: "Richiesta passaporto" },
            url: "docs/Dm.de passeport.pdf",
          },
          {
            title: { fr: "Statut", it: "Statuto CTOF" },
            url: "docs/statut.pdf",
          },
        ],
        events: [
          {
            title: {
              fr: "Atelier cuisine togolaise",
              it: "Laboratorio di cucina togolese",
            },
            date: "2025-11-05",
            desc: {
              fr: "Atelier communautaire",
              it: "Laboratorio comunitario",
            },
          },
        ],
      };

      function loadStore() {
        try {
          const raw =
            localStorage.getItem(STORE_KEY) ||
            localStorage.getItem(legacyStoreKey);
          return raw
            ? JSON.parse(raw)
            : JSON.parse(JSON.stringify(defaultData));
        } catch (e) {
          return JSON.parse(JSON.stringify(defaultData));
        }
      }

      // saveStore returns true on success, false on failure (quota, etc)
      function saveStore(data) {
        try {
          localStorage.setItem(STORE_KEY, JSON.stringify(data));
          return true;
        } catch (e) {
          console.error("saveStore failed:", e);
          // Friendly user message for quota / storage errors
          const msg =
            e && (e.name === "QuotaExceededError" || e.code === 22)
              ? "Stockage local plein ‚Äî impossible d'enregistrer le fichier. Supprimez des √©l√©ments ou utilisez de plus petits fichiers."
              : "Erreur lors de l'enregistrement local.";
          try {
            alert(msg);
          } catch (_) {}
          return false;
        }
      }

      // --- REMOTE-SAFE OVERRIDE: keep saveStore synchronous for callers,
      // but trigger remote save in background (if Supabase configured).
      (function attachRemoteSave() {
        try {
          // If supabaseClient and saveRemoteStore are available, attach background sync.
          if (typeof saveStore !== "function") return;
          const saveStoreLocal = saveStore;
          saveStore = function (data) {
            // call original local save (synchronous) and return its boolean
            let okLocal = false;
            try {
              okLocal = saveStoreLocal(data);
            } catch (e) {
              console.warn("saveStoreLocal exception:", e);
              okLocal = false;
            }

            // background remote attempt (non-blocking)
            // only if supabaseClient is initialized (see block above)
            if (typeof saveRemoteStore === "function" && typeof supabaseClient !== "undefined" && supabaseClient) {
              // do not await: show warnings in console only
              saveRemoteStore(data)
                .then((okRemote) => {
                  if (!okRemote) {
                    console.warn("Remote save failed (saveRemoteStore returned false).");
                  }
                })
                .catch((err) => {
                  console.warn("Remote save exception:", err);
                });
            }
            return okLocal;
          };
        } catch (err) {
          console.warn("attachRemoteSave error:", err);
        }
      })();

      let store = loadStore();

      /* ---------- Helpers for gallery entries ---------- */
      function generateId() {
        return Date.now() + "-" + Math.random().toString(36).slice(2, 8);
      }

      function normalizeGalleryEntry(entry) {
        // If entry is a string (legacy) convert to object
        if (!entry) return null;
        if (typeof entry === "string") {
          return {
            id: generateId(),
            url: entry,
            title: "",
            year: null,
            is_favorite: false,
            created_at: new Date().toISOString(),
          };
        }
        // If already object but missing fields, normalize
        return {
          id: entry.id || generateId(),
          url: entry.url || entry.src || "",
          title: entry.title || "",
          year:
            entry.year !== undefined && entry.year !== null
              ? parseInt(entry.year, 10)
              : entry.year || null,
          is_favorite: !!entry.is_favorite,
          created_at: entry.created_at || new Date().toISOString(),
        };
      }

      /* Normalize store to new bilingual structure and gallery objects */
      function normalizeStore() {
        // header_subtitle
        if (!store.header_subtitle)
          store.header_subtitle = JSON.parse(
            JSON.stringify(defaultData.header_subtitle)
          );
        if (typeof store.header_subtitle === "string") {
          store.header_subtitle = {
            fr: store.header_subtitle,
            it: store.header_subtitle,
          };
        }
        // documents
        if (!Array.isArray(store.documents))
          store.documents = JSON.parse(JSON.stringify(defaultData.documents));
        store.documents = store.documents.map((d) => {
          if (!d) return { title: { fr: "", it: "" }, url: "" };
          if (typeof d.title === "string") {
            return { title: { fr: d.title, it: d.title }, url: d.url || "" };
          }
          const tfr =
            (d.title && (d.title.fr || d.title.FR)) ||
            Object.values(d.title || {})[0] ||
            "";
          const tit =
            (d.title && (d.title.it || d.title.IT)) ||
            Object.values(d.title || {})[1] ||
            tfr;
          return {
            title: { fr: tfr || tit, it: tit || tfr },
            url: d.url || "",
            filename: d.filename || undefined,
          };
        });

        // gallery: convert strings or old format to objects
        if (!Array.isArray(store.gallery)) store.gallery = [];
        store.gallery = store.gallery
          .map(normalizeGalleryEntry)
          .filter(Boolean);

        // events
        if (!Array.isArray(store.events))
          store.events = JSON.parse(JSON.stringify(defaultData.events));
        store.events = store.events.map((ev) => {
          if (!ev) return JSON.parse(JSON.stringify(defaultData.events[0]));
          let titleObj = { fr: "", it: "" };
          if (typeof ev.title === "string")
            titleObj = { fr: ev.title, it: ev.title };
          else if (typeof ev.title === "object")
            titleObj = {
              fr: ev.title.fr || ev.title.FR || ev.title[0] || "",
              it:
                ev.title.it || ev.title.IT || ev.title[1] || ev.title[0] || "",
            };
          let descObj = { fr: "", it: "" };
          if (typeof ev.desc === "string")
            descObj = { fr: ev.desc, it: ev.desc };
          else if (typeof ev.desc === "object")
            descObj = {
              fr: ev.desc.fr || ev.desc.FR || "",
              it: ev.desc.it || ev.desc.IT || "",
            };
          return {
            title: {
              fr: titleObj.fr || titleObj.it || "",
              it: titleObj.it || titleObj.fr || "",
            },
            date: ev.date || "",
            desc: { fr: descObj.fr || "", it: descObj.it || "" },
          };
        });

        if (!store.lang) store.lang = defaultData.lang || "fr";

        // try to persist normalized store but tolerate failures
        saveStore(store);
      }

      normalizeStore();

      /* ================= Try remote load on init (if Supabase enabled) =================
         This will prefer remote data if available and replace local store in-memory,
         then re-render UI. This step is non-blocking for users without supabase.
      */
      (async function tryLoadRemoteOnInit() {
        if (typeof loadRemoteStore !== "function") return;
        if (typeof supabaseClient === "undefined" || !supabaseClient) return;
        try {
          const remote = await loadRemoteStore();
          if (remote && Object.keys(remote).length) {
            // remote found ‚Äî prefer it
            store = remote;
            // ensure normalized and persisted locally
            normalizeStore();
            // re-render UI to reflect remote
            try {
              renderGallery();
              renderDocs();
              renderEvents();
              renderFAQ(store.lang || "fr");
            } catch (e) {
              console.warn("render after remote load failed:", e);
            }
          }
        } catch (err) {
          console.warn("tryLoadRemoteOnInit error:", err);
        }
      })();

      /* ================= Translations & helpers ================= */
      const translations = {
        fr: {
          site_title: "COMMUNAUT√â DES TOGOLAIS DE FERRARA",
          nav_home: "Accueil",
          nav_gallery: "Galerie",
          nav_docs: "Documents",
          nav_events: "√âv√©nements",
          nav_address: "Adresse",
          nav_admin: "Admin",
          hero_title: "Bienvenue √† la CTOF",
          hero_sub:
            "Association togolaise √† Ferrara ‚Äî culture, entraide et √©v√©nements communautaires.",
          hero_cta: "Voir les √©v√©nements",
          about: "√Ä PROPOS DE CTOF",
          about_text:
            "L‚Äôassociation CTOF promeut la culture togolaise et favorise l‚Äôint√©gration √† Ferrara. Nous organisons √©v√©nements, actions solidaires et ateliers pour la communaut√©.",
          documents: "DOCUMENTS OFFICIELS",
          events: "√âV√âNEMENTS",
          quick_gallery: "Galerie rapide",
          view_all: "Voir toute la galerie",
          contact: "Contact",
          useful: "Infos utiles",
          gallery: "GALERIE",
          address: "O√ô NOUS TROUVER",
          videos: "VID√âOS",
          admin_panel: "Panneau Admin",
          header_subtitle:
            store.header_subtitle && store.header_subtitle.fr
              ? store.header_subtitle.fr
              : "Association culturelle & solidaire",
          faq_title: "FAQ ‚Äì Questions fr√©quentes",
          faq_button: "üìñ Voir les FAQ",
          btn_open: "Ouvrir",
          btn_edit: "√âditer",
          btn_delete: "Supprimer",
          admin_connected: "Connect√©",
        },
        it: {
          site_title: "COMUNIT√Ä DEI TOGOLESI DI FERRARA",
          nav_home: "Home",
          nav_gallery: "Galleria",
          nav_docs: "Documenti",
          nav_events: "Eventi",
          nav_address: "Indirizzo",
          nav_admin: "Admin",
          hero_title: "Benvenuti alla CTOF",
          hero_sub:
            "Associazione togolese a Ferrara ‚Äî cultura, solidariet√† ed eventi.",
          hero_cta: "Vedi gli eventi",
          about: "CHI SIAMO",
          about_text:
            "L'associazione CTOF promuove la cultura togolese e favorisce l'integrazione a Ferrara. Organizziamo eventi, azioni solidali e workshop per la comunit√†.",
          documents: "DOCUMENTI UFFICIALI",
          events: "EVENTI",
          quick_gallery: "Galleria rapida",
          view_all: "Vedi tutta la galleria",
          contact: "Contatti",
          useful: "Info utili",
          gallery: "GALLERIA",
          address: "DOVE SIAMO",
          videos: "VIDEO",
          admin_panel: "Pannello Admin",
          header_subtitle:
            store.header_subtitle && store.header_subtitle.it
              ? store.header_subtitle.it
              : "Associazione culturale e solidale",
          faq_title: "FAQ ‚Äì Domande frequenti",
          faq_button: "üìñ Visualizza le FAQ",
          btn_open: "Apri",
          btn_edit: "Modifica",
          btn_delete: "Elimina",
          admin_connected: "Connesso",
        },
      };

      /* ================= RENDER FUNCTIONS ================= */
      const galleryGrid = document.getElementById("galleryGrid");
      const fullGallery = document.getElementById("fullGallery");
      const galleryYearsEl = document.getElementById("galleryYears");
      const docsGrid = document.getElementById("docsGrid");
      const eventsList = document.getElementById("eventsList");

      // state: selected year filter (null = all, "no-year" = images without year, otherwise "2024" etc.)
      let gallerySelectedYear = null;

      function getUniqueYears() {
        const years = new Set();
        (store.gallery || []).forEach((g) => {
          if (g.year) years.add(String(g.year));
        });
        return Array.from(years).sort(
          (a, b) => parseInt(b, 10) - parseInt(a, 10)
        );
      }

  // --- Mise √† jour : traduction imm√©diate des boutons d'ann√©es & fix toggle FAQ ---
  // safe helper: labels selon la langue courante
  function galleryLabelAll() {
    return store && store.lang === "it" ? "Tutti" : "Tous";
  }
  function galleryLabelNoYear() {
    return store && store.lang === "it" ? "Senza anno" : "Sans ann√©e";
  }

  /* ================= NEW: renderQuickGallery =================
     Shows images marked as is_favorite in the quick sidebar gallery.
     If there are no favorites, falls back to the most recent images.
     Adds a visual star badge for favorites.
  */
  function renderQuickGallery() {
    try {
      if (!galleryGrid) return;
      galleryGrid.innerHTML = "";

      // choose favorites first
      let favs = (store.gallery || [])
        .filter((g) => !!g.is_favorite)
        .slice()
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      // fallback: if no favorites, show most recent images (limit 6)
      if (!favs.length) {
        favs = (store.gallery || [])
          .slice()
          .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          .slice(0, 6);
      }

      // limit number of thumbnails in sidebar quick gallery
      const show = favs.slice(0, 6);
      show.forEach((g) => {
        const div = document.createElement("div");
        div.className = "gallery-item";
        div.setAttribute("role", "button");
        div.setAttribute("tabindex", "0");

        const img = document.createElement("img");
        img.src = g.url;
        img.alt = g.title || "";

        // favorite badge
        if (g.is_favorite) {
          const badge = document.createElement("div");
          badge.className = "fav-badge";
          badge.innerHTML = `<i class="fas fa-star"></i><span class="small">Favori</span>`;
          div.appendChild(badge);
        }

        div.appendChild(img);

        // click + keyboard accessibility
        div.addEventListener("click", () => openLightbox(g.url));
        div.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openLightbox(g.url);
          }
        });

        galleryGrid.appendChild(div);
      });

      // if empty still, show placeholder text
      if (!show.length) {
        const p = document.createElement("p");
        p.className = "muted";
        p.textContent =
          store.lang === "it"
            ? "Nessuna immagine disponibile."
            : "Aucune image disponible.";
        galleryGrid.appendChild(p);
      }
    } catch (err) {
      console.error("renderQuickGallery error:", err);
    }
  }

  function renderGalleryYears() {
    try {
      if (!galleryYearsEl) return;
      galleryYearsEl.innerHTML = "";

      const years = getUniqueYears();
      const currentYear = String(new Date().getFullYear());

      // "Tous"
      const allBtn = document.createElement("button");
      allBtn.className = "year-btn";
      allBtn.textContent = galleryLabelAll();
      if (gallerySelectedYear === null) allBtn.classList.add("active");
      allBtn.addEventListener("click", () => {
        gallerySelectedYear = null;
        renderGallery();
        renderGalleryYears();
      });
      galleryYearsEl.appendChild(allBtn);

      // year buttons (descending)
      years.forEach((y) => {
        const yBtn = document.createElement("button");
        yBtn.className = "year-btn";
        yBtn.textContent = y;
        if (gallerySelectedYear === y) yBtn.classList.add("active");
        // visual emphasis for current year (optional)
        if (y === currentYear && gallerySelectedYear === null) {
          // only visual; selection remains "all"
          yBtn.classList.add("active");
        }
        yBtn.addEventListener("click", () => {
          gallerySelectedYear = y;
          renderGallery();
          renderGalleryYears();
        });
        galleryYearsEl.appendChild(yBtn);
      });

      // "Sans ann√©e" if present
      const hasNoYear = (store.gallery || []).some((g) => !g.year);
      if (hasNoYear) {
        const ny = document.createElement("button");
        ny.className = "year-btn";
        ny.textContent = galleryLabelNoYear();
        if (gallerySelectedYear === "no-year") ny.classList.add("active");
        ny.addEventListener("click", () => {
          gallerySelectedYear = "no-year";
          renderGallery();
          renderGalleryYears();
        });
        galleryYearsEl.appendChild(ny);
      }
    } catch (err) {
      console.error("renderGalleryYears error:", err);
    }
  }

  function renderGallery() {
    try {
      if (!fullGallery) return;
      fullGallery.innerHTML = "";

      const items = (store.gallery || []).slice().sort((a, b) => {
        return new Date(b.created_at) - new Date(a.created_at);
      });

      const groups = items.reduce((acc, it) => {
        const key = it.year ? String(it.year) : "Sans ann√©e";
        if (!acc[key]) acc[key] = [];
        acc[key].push(it);
        return acc;
      }, {});

      const yearKeys = Object.keys(groups).sort((a, b) => {
        if (a === "Sans ann√©e") return 1;
        if (b === "Sans ann√©e") return -1;
        return parseInt(b, 10) - parseInt(a, 10);
      });

      // render buttons (will use current store.lang for labels)
      renderGalleryYears();

      let renderedAny = false;
      yearKeys.forEach((k) => {
        const keyIsNoYear = k === "Sans ann√©e";

        // filter by selected year
        if (gallerySelectedYear !== null) {
          if (gallerySelectedYear === "no-year") {
            if (!keyIsNoYear) return;
          } else {
            if (gallerySelectedYear !== k) return;
          }
        }

        renderedAny = true;
        const section = document.createElement("div");
        section.className = "album-section";

        const titleBar = document.createElement("div");
        titleBar.className = "album-title";
        const h3 = document.createElement("h3");
        h3.textContent = keyIsNoYear ? galleryLabelNoYear() : k;
        const count = document.createElement("div");
        count.className = "album-count small muted";
        count.textContent = `${groups[k].length} photo(s)`;
        titleBar.appendChild(h3);
        titleBar.appendChild(count);
        section.appendChild(titleBar);

        const grid = document.createElement("div");
        grid.className = "gallery-grid";
        groups[k].forEach((g) => {
          const div = document.createElement("div");
          div.className = "gallery-item";
          const img = document.createElement("img");
          img.src = g.url;
          img.alt = g.title || "";
          div.appendChild(img);
          div.addEventListener("click", () => openLightbox(g.url));
          grid.appendChild(div);
        });

        section.appendChild(grid);
        fullGallery.appendChild(section);
      });

      if (!renderedAny) {
        const p = document.createElement("p");
        p.className = "muted";
        if (gallerySelectedYear === "no-year") {
          p.textContent = store.lang === "it" ? "Nessuna immagine per quest'anno." : "Aucune image pour cette ann√©e.";
        } else {
          p.textContent = store.lang === "it" ? "Nessuna immagine per questa selezione." : "Aucune image dans la galerie pour le moment.";
        }
        fullGallery.appendChild(p);
      }

      // quick gallery (favorites)
      renderQuickGallery();
    } catch (err) {
      console.error("renderGallery error:", err);
    }
  }

  // Toggle FAQ: rewritten to avoid cloneNode issues and double-binding
  (function initToggleFAQ() {
    try {
      const toggleBtn = document.getElementById("toggle-faq");
      const faqEl = document.getElementById("faq");
      if (!toggleBtn || !faqEl) return;

      function setLabel(open) {
        const label =
          toggleBtn.getAttribute("data-" + (store.lang || "fr")) ||
          (store.lang === "it" ? "üìñ Visualizza le FAQ" : "üìñ Voir les FAQ");
        toggleBtn.textContent = open ? label + " ‚ñ≤" : label;
      }

      // initial label
      setLabel(false);

      // avoid adding multiple listeners: guard with data attribute
      if (!toggleBtn.dataset.faqInitialized) {
        toggleBtn.addEventListener("click", () => {
          const isHidden = faqEl.classList.contains("hidden");
          if (isHidden) {
            faqEl.classList.remove("hidden");
            faqEl.setAttribute("aria-hidden", "false");
            setLabel(true);
            // open the first FAQ answer to make content immediately visible
            const firstAns = faqEl.querySelector(".faq-answer");
            if (firstAns) {
              faqEl.querySelectorAll(".faq-answer").forEach((a) =>
                a.classList.remove("open")
              );
              firstAns.classList.add("open");
              faqEl
                .querySelectorAll(".faq-question")
                .forEach((q) => q.setAttribute("aria-expanded", "false"));
              const firstQ = faqEl.querySelector(".faq-question");
              if (firstQ) firstQ.setAttribute("aria-expanded", "true");
            }
          } else {
            faqEl.classList.add("hidden");
            faqEl.setAttribute("aria-hidden", "true");
            setLabel(false);
            // collapse all answers when hiding
            faqEl
              .querySelectorAll(".faq-answer")
              .forEach((a) => a.classList.remove("open"));
            faqEl
              .querySelectorAll(".faq-question")
              .forEach((q) => q.setAttribute("aria-expanded", "false"));
          }
        });
        toggleBtn.dataset.faqInitialized = "1";
      }
    } catch (err) {
      console.error("initToggleFAQ error:", err);
    }
  })();

      /* Documents rendering (unchanged from previous improved version) */
      function truncate(s, n = 60) {
        if (!s) return "";
        return s.length > n ? s.slice(0, n) + "‚Ä¶" : s;
      }

      function renderDocs() {
        if (typeof docsGrid === "undefined" || !docsGrid) return;
        docsGrid.innerHTML = "";

        (store.documents || []).forEach((d) => {
          const card = document.createElement("div");
          card.className = "doc-card";

          const meta = document.createElement("div");
          meta.style.flex = "1";

          let titleText =
            (d.title && d.title[store.lang]) ||
            (d.title && d.title.fr) ||
            (d.title && d.title.it) ||
            "";
          if (!titleText && d.filename) titleText = d.filename;
          if (!titleText) titleText = "Document";

          const h4 = document.createElement("h4");
          h4.textContent = titleText;

          let smallText = "";
          if (d.url && !d.url.startsWith("data:")) {
            const u = d.url || "";
            smallText = truncate(u, 60);
          }

          meta.appendChild(h4);
          if (smallText) {
            const small = document.createElement("small");
            small.textContent = smallText;
            meta.appendChild(small);
          }

          const actions = document.createElement("div");
          actions.className = "doc-actions";

          let safeHref = "#";
          if (d && d.url) {
            if (d.url.startsWith("data:")) {
              safeHref = d.url;
            } else {
              const normalized = d.url.replace(/\\/g, "/");
              if (/^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(normalized)) {
                safeHref = normalized;
              } else {
                safeHref = encodeURI(normalized);
              }
            }
          }

          const a = document.createElement("a");
          a.className = "btn";
          a.href = safeHref;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.textContent =
            (translations &&
              translations[store.lang] &&
              translations[store.lang].btn_open) ||
            (store.lang === "it" ? "Apri" : "Ouvrir");

          if (d.filename) {
            a.download = d.filename;
          } else if (d.url && d.url.startsWith("data:")) {
            const mime = (
              d.url.split(";")[0] || "application/octet-stream"
            ).replace("data:", "");
            const ext = (mime.split("/")[1] || "pdf").replace(/[^\w]/g, "");
            a.download = "document." + ext;
          }

          actions.appendChild(a);

          card.appendChild(meta);
          card.appendChild(actions);
          docsGrid.appendChild(card);
        });
      }

      function renderEvents(filter = "all") {
        if (!eventsList) return;
        eventsList.innerHTML = "";
        const now = new Date();
        let events = (store.events || [])
          .slice()
          .sort((a, b) => new Date(a.date) - new Date(b.date));
        events.forEach((ev) => {
          const isPast = new Date(ev.date) < now;
          if (filter === "upcoming" && isPast) return;
          if (filter === "past" && !isPast) return;
          const node = document.createElement("div");
          node.className = "event";
          const h4 = document.createElement("h4");
          h4.textContent =
            (ev.title && ev.title[store.lang]) ||
            ev.title.fr ||
            ev.title.it ||
            "";
          const small = document.createElement("small");
          small.className = "muted";
          small.textContent = ev.date;
          const p = document.createElement("p");
          p.textContent =
            (ev.desc && ev.desc[store.lang]) || ev.desc.fr || ev.desc.it || "";
          node.appendChild(h4);
          node.appendChild(small);
          node.appendChild(p);
          eventsList.appendChild(node);
        });
      }

      // ... rest of file unchanged (FAQ data, admin scripts, event handlers, initial render) ...
      // (the rest of the previously shown script follows unchanged)

      function renderFAQ(lang) {
        const faqContainer = document.getElementById("faq");
        if (!faqContainer) return;
        faqContainer.innerHTML = "";
        if (!window.__CTOF_FAQ || !Array.isArray(window.__CTOF_FAQ)) return;
        window.__CTOF_FAQ.forEach((item) => {
          const itDiv = document.createElement("div");
          itDiv.className = "faq-item";
          const qBtn = document.createElement("button");
          qBtn.className = "faq-question";
          qBtn.innerHTML = item.q[lang] || item.q.fr;
          qBtn.setAttribute("aria-expanded", "false");
          const ans = document.createElement("div");
          ans.className = "faq-answer";
          ans.innerHTML = item.a[lang] || item.a.fr;
          itDiv.appendChild(qBtn);
          itDiv.appendChild(ans);
          faqContainer.appendChild(itDiv);

          // attach toggle behavior per question (fresh elements => safe to add)
          qBtn.addEventListener("click", () => {
            const open = ans.classList.contains("open");
            // collapse all other answers for accordion behavior
            faqContainer
              .querySelectorAll(".faq-answer")
              .forEach((a) => a.classList.remove("open"));
            faqContainer
              .querySelectorAll(".faq-question")
              .forEach((q) => q.setAttribute("aria-expanded", "false"));
            if (!open) {
              ans.classList.add("open");
              qBtn.setAttribute("aria-expanded", "true");
              // scroll into view a bit (optional)
              setTimeout(
                () =>
                  qBtn.scrollIntoView({ behavior: "smooth", block: "center" }),
                100
              );
            } else {
              ans.classList.remove("open");
              qBtn.setAttribute("aria-expanded", "false");
            }
          });
        });

        // If the FAQ container is visible (not hidden), open the first item so content is immediately readable
        if (!faqContainer.classList.contains("hidden")) {
          const firstAns = faqContainer.querySelector(".faq-answer");
          const firstQ = faqContainer.querySelector(".faq-question");
          if (firstAns) firstAns.classList.add("open");
          if (firstQ) firstQ.setAttribute("aria-expanded", "true");
        }
      }


      /* ================= ADMIN functions (gallery upload + metadata) ================= */
      (function adminScripts() {
        const $ = (id) => document.getElementById(id);

        const adminPage = $("admin-page");
        const adminClosePage = $("admin-close-page");
        const adminLogout = $("admin-logout");
        const adminSaveAll = $("admin-save-all");

        const hdrFr = $("hdr_fr");
        const hdrIt = $("hdr_it");

        const imgUrlInput = $("imgUrlInput");
        const addImgUrlBtn = $("addImgUrlBtn");
        const imgFileInput = $("imgFileInput");
        const uploadImgFileBtn = $("uploadImgFileBtn");
        const galleryAdminList = $("galleryAdminList");
        const adminDefaultYear = $("adminDefaultYear");
        const adminDefaultFav = $("adminDefaultFav");

        const adminThumbs = $("adminThumbs");
        const saveAndClose = $("saveAndClose");
        const clearLocalBtn = $("clearLocalBtn");

        const bulkMarkFavBtn = $("bulkMarkFavBtn");
        const bulkUnmarkFavBtn = $("bulkUnmarkFavBtn");
        const bulkDeleteBtn = $("bulkDeleteBtn");

        // editing helpers
        let selectedAdminIds = new Set();

        function openAdminPage() {
          const main = document.querySelector("main");
          if (main) main.style.display = "none";
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
          if (adminPage) {
            adminPage.classList.add("open");
            adminPage.setAttribute("aria-hidden", "false");
          }
          hdrFr.value =
            (store.header_subtitle && store.header_subtitle.fr) || "";
          hdrIt.value =
            (store.header_subtitle && store.header_subtitle.it) || "";
          renderAdminGallery();
          renderAdminDocs();
          renderAdminEvents();
        }

        function closeAdminPage() {
          if (adminPage) {
            adminPage.classList.remove("open");
            adminPage.setAttribute("aria-hidden", "true");
          }
          const main = document.querySelector("main");
          if (main) main.style.display = "";
          renderGallery();
          renderDocs();
          renderEvents();
          applyLang(store.lang || "fr");
        }

        if (adminClosePage)
          adminClosePage.addEventListener("click", closeAdminPage);
        if (adminLogout) adminLogout.addEventListener("click", closeAdminPage);
        if (adminSaveAll)
          adminSaveAll.addEventListener("click", () => {
            // Save header subtitle and other inputs; provide user feedback on failure
            saveFromAdminInputs();
            const ok = saveStore(store);
            if (!ok) {
              // do not close; allow user to adjust files
              return;
            }
            alert(store.lang === "it" ? "Salvato" : "Enregistr√©");
          });

        function saveFromAdminInputs() {
          store.header_subtitle = {
            fr: hdrFr.value.trim(),
            it: hdrIt.value.trim(),
          };
          // try to persist; caller checks success
          // Note: do not overwrite store if save fails ‚Äî saveStore returns false
        }

        /* Add image from URL (prompts for year/fav) */
        addImgUrlBtn &&
          addImgUrlBtn.addEventListener("click", () => {
            const url = imgUrlInput.value.trim();
            if (!url) return alert("URL manquante");
            const yearVal =
              adminDefaultYear && adminDefaultYear.value
                ? parseInt(adminDefaultYear.value, 10)
                : null;
            const fav = !!(adminDefaultFav && adminDefaultFav.checked);
            const obj = {
              id: generateId(),
              url,
              title: "",
              year: yearVal,
              is_favorite: fav,
              created_at: new Date().toISOString(),
            };
            store.gallery.unshift(obj);
            const saved = saveStore(store);
            if (!saved) {
              // revert change if cannot save
              store.gallery.shift();
              return;
            }
            imgUrlInput.value = "";
            renderAdminGallery();
            // ensure quick gallery reflects updates
            renderGallery();
          });

        /* Upload image files (multiple) -> store dataURL + metadata */
        uploadImgFileBtn &&
          uploadImgFileBtn.addEventListener("click", () => {
            const files = imgFileInput.files;
            if (!files || !files.length)
              return alert("Choisissez au moins un fichier image.");
            const defaultYear =
              adminDefaultYear && adminDefaultYear.value
                ? parseInt(adminDefaultYear.value, 10)
                : null;
            const defaultFav = !!(adminDefaultFav && adminDefaultFav.checked);

            // size recommendation / limit to avoid localStorage quota issues
            const MAX_FILE_BYTES = 1.5 * 1024 * 1024; // 1.5MB recommended

            Array.from(files).forEach((file) => {
              if (file.size > MAX_FILE_BYTES) {
                alert(
                  `Le fichier "${file.name}" est trop gros (${Math.round(
                    file.size / 1024
                  )}KB). Taille max recommand√©e: ${Math.round(
                    MAX_FILE_BYTES / 1024
                  )}KB. Ignor√©.`
                );
                return;
              }

              const reader = new FileReader();
              reader.onload = function (e) {
                const dataUrl = e.target.result;
                const obj = {
                  id: generateId(),
                  url: dataUrl,
                  title: file.name || "",
                  year: defaultYear,
                  is_favorite: defaultFav,
                  created_at: new Date().toISOString(),
                };
                store.gallery.unshift(obj);
                const ok = saveStore(store);
                if (!ok) {
                  // revert the addition to avoid inconsistent state in-memory
                  store.gallery = store.gallery.filter((g) => g.id !== obj.id);
                  console.warn("Image not saved due to storage error; reverted.");
                  return;
                }
                renderAdminGallery();
                renderGallery();
              };
              reader.onerror = function (e) {
                console.error("FileReader error", e);
                alert("Erreur lecture fichier: " + file.name);
              };
              reader.readAsDataURL(file);
            });
            imgFileInput.value = "";
          });

        /* Render admin gallery list with controls per image */
        function renderAdminGallery() {
          if (!galleryAdminList) return;
          galleryAdminList.innerHTML = "";
          selectedAdminIds.clear();
          adminThumbs && (adminThumbs.innerHTML = "");

          (store.gallery || []).forEach((g, idx) => {
            const row = document.createElement("div");
            row.className = "img-item-admin";

            const left = document.createElement("div");
            left.style.display = "flex";
            left.style.gap = "8px";
            left.style.alignItems = "center";

            const img = document.createElement("img");
            img.src = g.url;
            left.appendChild(img);

            const meta = document.createElement("div");
            meta.style.flex = "1";
            const title = document.createElement("div");
            title.style.fontWeight = "700";
            title.textContent = g.title || "Image " + (idx + 1);
            const small = document.createElement("div");
            small.className = "small";
            small.textContent =
              g.url.length > 60 ? g.url.slice(0, 60) + "‚Ä¶" : g.url;
            meta.appendChild(title);
            meta.appendChild(small);

            left.appendChild(meta);

            const controls = document.createElement("div");
            controls.style.display = "flex";
            controls.style.flexDirection = "column";
            controls.style.alignItems = "flex-end";
            controls.style.gap = "6px";

            // checkbox for selection
            const select = document.createElement("input");
            select.type = "checkbox";
            select.title = "S√©lectionner";
            select.addEventListener("change", (ev) => {
              if (ev.target.checked) selectedAdminIds.add(g.id);
              else selectedAdminIds.delete(g.id);
            });

            // year input
            const yearInput = document.createElement("input");
            yearInput.type = "number";
            yearInput.min = 1900;
            yearInput.max = 2100;
            yearInput.value = g.year || "";
            yearInput.style.width = "88px";
            yearInput.placeholder = "Ann√©e";

            // fav checkbox
            const favLabel = document.createElement("label");
            favLabel.style.display = "flex";
            favLabel.style.alignItems = "center";
            favLabel.style.gap = "6px";
            const favInput = document.createElement("input");
            favInput.type = "checkbox";
            favInput.checked = !!g.is_favorite;
            favLabel.appendChild(favInput);
            const favText = document.createElement("span");
            favText.textContent = "Favori";
            favText.className = "small";
            favLabel.appendChild(favText);

            // save metadata button
            const saveBtn = document.createElement("button");
            saveBtn.className = "btn ghost";
            saveBtn.type = "button";
            saveBtn.textContent = "Mettre √† jour";
            saveBtn.addEventListener("click", () => {
              const newYear = yearInput.value
                ? parseInt(yearInput.value, 10)
                : null;
              g.year = newYear;
              g.is_favorite = !!favInput.checked;
              const ok = saveStore(store);
              if (!ok) {
                alert("Impossible d'enregistrer les modifications (stockage).");
                return;
              }
              renderAdminGallery();
              renderGallery();
            });

            const delBtn = document.createElement("button");
            delBtn.className = "btn danger";
            delBtn.type = "button";
            delBtn.textContent = "Supprimer";
            delBtn.addEventListener("click", () => {
              if (!confirm("Supprimer cette image ?")) return;
              const i = store.gallery.findIndex((x) => x.id === g.id);
              if (i >= 0) store.gallery.splice(i, 1);
              saveStore(store);
              renderAdminGallery();
              renderGallery();
            });

            controls.appendChild(select);
            controls.appendChild(yearInput);
            controls.appendChild(favLabel);
            controls.appendChild(saveBtn);
            controls.appendChild(delBtn);

            row.appendChild(left);
            row.appendChild(controls);
            galleryAdminList.appendChild(row);

            // small thumb in right column
            if (adminThumbs) {
              const t = document.createElement("img");
              t.src = g.url;
              t.style.width = "100%";
              t.style.height = "70px";
              t.style.objectFit = "cover";
              adminThumbs.appendChild(t);
            }
          });
        }

        // bulk actions
        bulkMarkFavBtn &&
          bulkMarkFavBtn.addEventListener("click", () => {
            if (!selectedAdminIds.size)
              return alert("Aucune image s√©lectionn√©e");
            store.gallery.forEach((g) => {
              if (selectedAdminIds.has(g.id)) g.is_favorite = true;
            });
            const ok = saveStore(store);
            if (!ok) return;
            renderAdminGallery();
            renderGallery();
          });
        bulkUnmarkFavBtn &&
          bulkUnmarkFavBtn.addEventListener("click", () => {
            if (!selectedAdminIds.size)
              return alert("Aucune image s√©lectionn√©e");
            store.gallery.forEach((g) => {
              if (selectedAdminIds.has(g.id)) g.is_favorite = false;
            });
            const ok = saveStore(store);
            if (!ok) return;
            renderAdminGallery();
            renderGallery();
          });
        bulkDeleteBtn &&
          bulkDeleteBtn.addEventListener("click", () => {
            if (!selectedAdminIds.size)
              return alert("Aucune image s√©lectionn√©e");
            if (!confirm("Supprimer les images s√©lectionn√©es ?")) return;
            store.gallery = store.gallery.filter(
              (g) => !selectedAdminIds.has(g.id)
            );
            selectedAdminIds.clear();
            const ok = saveStore(store);
            if (!ok) return;
            renderAdminGallery();
            renderGallery();
          });

        /* Documents admin (unchanged behavior with quota-safe save) */
        const docTitleFr = $("docTitleInput_fr");
        const docTitleIt = $("docTitleInput_it");
        const docUrlInput = $("docUrlInput");
        const docFileInput = $("docFileInput");
        const addDocBtn = $("addDocBtn");
        const docsAdminList = $("docsAdminList");

        addDocBtn &&
          addDocBtn.addEventListener("click", () => {
            const titleFr = docTitleFr.value.trim();
            const titleIt = docTitleIt.value.trim();
            const url = docUrlInput.value.trim();
            const file = docFileInput.files && docFileInput.files[0];
            if (!titleFr || !titleIt || (!url && !file))
              return alert("Remplir titre FR/IT et fournir URL ou fichier");

            // doc file size limit recommendation
            const MAX_DOC_BYTES = 3 * 1024 * 1024; // 3MB

            if (file) {
              if (file.size > MAX_DOC_BYTES) {
                return alert(
                  `Le fichier "${file.name}" est trop gros (${Math.round(
                    file.size / 1024
                  )}KB). Taille max recommand√©e: ${Math.round(
                    MAX_DOC_BYTES / 1024
                  )}KB.`
                );
              }
              const reader = new FileReader();
              reader.onload = function (e) {
                const dataUrl = e.target.result;
                const doc = {
                  title: { fr: titleFr, it: titleIt },
                  url: dataUrl,
                  filename: file.name,
                };
                store.documents.unshift(doc);
                const ok = saveStore(store);
                if (!ok) {
                  // revert
                  store.documents = store.documents.filter((d) => d !== doc);
                  return;
                }
                docTitleFr.value = "";
                docTitleIt.value = "";
                docUrlInput.value = "";
                docFileInput.value = "";
                renderAdminDocs();
                renderDocs();
              };
              reader.onerror = function (e) {
                console.error("FileReader error", e);
                alert("Erreur lecture fichier: " + file.name);
              };
              reader.readAsDataURL(file);
            } else {
              const doc = { title: { fr: titleFr, it: titleIt }, url };
              store.documents.unshift(doc);
              const ok = saveStore(store);
              if (!ok) {
                // revert
                store.documents = store.documents.filter((d) => d !== doc);
                return;
              }
              docTitleFr.value = "";
              docTitleIt.value = "";
              docUrlInput.value = "";
              renderAdminDocs();
              renderDocs();
            }
          });

        function renderAdminDocs() {
          if (!docsAdminList) return;
          docsAdminList.innerHTML = "";
          (store.documents || []).forEach((d, idx) => {
            const div = document.createElement("div");
            div.className = "doc-item";
            const left = document.createElement("div");
            left.style.flex = "1";
            left.innerHTML = `<div style="font-weight:700">${
              (d.title && d.title[store.lang]) || d.title.fr || d.title.it
            }</div><div class="small">${
              d.filename || (d.url && d.url.slice(0, 40)) || ""
            }</div>`;
            const actions = document.createElement("div");
            const open = document.createElement("a");
            open.className = "btn ghost";
            open.textContent = store.lang === "it" ? "Apri" : "Ouvrir";
            open.href = d.url || "#";
            open.target = "_blank";
            const del = document.createElement("button");
            del.className = "btn danger";
            del.type = "button";
            del.textContent = store.lang === "it" ? "Elimina" : "Supprimer";
            del.addEventListener("click", () => {
              if (
                !confirm(
                  store.lang === "it"
                    ? "Eliminare documento?"
                    : "Supprimer le document ?"
                )
              )
                return;
              store.documents.splice(idx, 1);
              saveStore(store);
              renderAdminDocs();
              renderDocs();
            });
            actions.appendChild(open);
            actions.appendChild(del);
            div.appendChild(left);
            div.appendChild(actions);
            docsAdminList.appendChild(div);
          });
        }

        /* Events admin (reused from previous logic) */
        const evTitleFr = $("evTitle_fr_admin");
        const evTitleIt = $("evTitle_it_admin");
        const evDate = $("evDate_admin");
        const evDescFr = $("evDesc_fr_admin");
        const evDescIt = $("evDesc_it_admin");
        const createEvBtn = $("createEvBtn");
        const clearEvFormBtn = $("clearEvFormBtn");
        const eventsAdminListEl = $("eventsAdminList");

        let editingEventIndex = null;
        createEvBtn &&
          createEvBtn.addEventListener("click", () => {
            const tfr = evTitleFr.value.trim();
            const tit = evTitleIt.value.trim();
            const d = evDate.value;
            const df = evDescFr.value.trim();
            const di = evDescIt.value.trim();
            if (!tfr || !tit || !d) return alert("Titre FR/IT et date requis");
            const evObj = {
              title: { fr: tfr, it: tit },
              date: d,
              desc: { fr: df, it: di },
            };
            if (editingEventIndex !== null) {
              store.events[editingEventIndex] = evObj;
              editingEventIndex = null;
            } else store.events.unshift(evObj);
            const ok = saveStore(store);
            if (!ok) {
              alert("Impossible d'enregistrer l'√©v√©nement (stockage).");
              return;
            }
            evTitleFr.value = "";
            evTitleIt.value = "";
            evDate.value = "";
            evDescFr.value = "";
            evDescIt.value = "";
            renderAdminEvents();
            renderEvents();
          });

        function renderAdminEvents() {
          if (!eventsAdminListEl) return;
          eventsAdminListEl.innerHTML = "";
          (store.events || []).forEach((ev, idx) => {
            const div = document.createElement("div");
            div.className = "admin-event-item";
            const left = document.createElement("div");
            left.style.flex = "1";
            left.innerHTML = `<div style="font-weight:700">${
              (ev.title && ev.title[store.lang]) || ev.title.fr || ev.title.it
            }</div><div class="small">${ev.date}</div>`;
            const actions = document.createElement("div");
            actions.style.display = "flex";
            actions.style.gap = "6px";
            const edit = document.createElement("button");
            edit.className = "btn ghost";
            edit.type = "button";
            edit.textContent = store.lang === "it" ? "Modifica" : "√âditer";
            edit.addEventListener("click", () => {
              evTitleFr.value = ev.title.fr || "";
              evTitleIt.value = ev.title.it || "";
              evDate.value = ev.date || "";
              evDescFr.value = ev.desc.fr || "";
              evDescIt.value = ev.desc.it || "";
              editingEventIndex = idx;
            });
            const del = document.createElement("button");
            del.className = "btn danger";
            del.type = "button";
            del.textContent = store.lang === "it" ? "Elimina" : "Supprimer";
            del.addEventListener("click", () => {
              if (
                !confirm(
                  store.lang === "it"
                    ? "Eliminare evento?"
                    : "Supprimer cet √©v√©nement ?"
                )
              )
                return;
              store.events.splice(idx, 1);
              saveStore(store);
              renderAdminEvents();
              renderEvents();
            });
            actions.appendChild(edit);
            actions.appendChild(del);
            div.appendChild(left);
            div.appendChild(actions);
            eventsAdminListEl.appendChild(div);
          });
        }

        /* Save & close / clear local */
        saveAndClose &&
          saveAndClose.addEventListener("click", () => {
            saveFromAdminInputs();
            const ok = saveStore(store);
            if (!ok) return;
            closeAdminPage();
          });

        clearLocalBtn &&
          clearLocalBtn.addEventListener("click", () => {
            if (!confirm("R√©initialiser les donn√©es locales ?")) return;
            localStorage.removeItem(STORE_KEY);
            localStorage.removeItem(legacyStoreKey);
            store = JSON.parse(JSON.stringify(defaultData));
            normalizeStore();
            saveStore(store);
            renderGallery();
            renderDocs();
            renderEvents();
            applyLang(store.lang || "fr");
            closeAdminPage();
          });

        // Expose open/close for other scripts
        window.__admin = { openAdminPage, closeAdminPage, renderAdminGallery };
      })();

      /* ================= ADMIN button hook (prompt) ================= */
      (function adminButtonFix() {
        function $(id) {
          return document.getElementById(id);
        }
        const openAdminBtn = $("open-admin");
        if (!openAdminBtn) return;
        openAdminBtn.addEventListener("click", function (e) {
          e.preventDefault();
          const ask =
            store && store.lang === "it"
              ? "Mot de passe admin (it/fr) / Inserire la password admin"
              : "Mot de passe admin";
          const pw = prompt(ask);
          if (pw === null) return;
          if (pw.trim() === "ctofadmin" || pw.trim() === "demo") {
            if (
              window.__admin &&
              typeof window.__admin.openAdminPage === "function"
            ) {
              window.__admin.openAdminPage();
            } else {
              const adminPage = document.getElementById("admin-page");
              const main = document.querySelector("main");
              if (adminPage) {
                adminPage.classList.add("open");
                adminPage.setAttribute("aria-hidden", "false");
              }
              if (main) main.style.display = "none";
            }
          } else {
            alert(
              store && store.lang === "it"
                ? "Password errata"
                : "Mot de passe incorrect"
            );
          }
        });
      })();

      /* ================= GLOBAL UI helpers & rest of script ================= */
      function renderAdminEvents() {
        /* placeholder - already defined inside adminScripts */
      }
      function renderAdminDocs() {
        /* placeholder - already defined inside adminScripts */
      }

      /* ================= LIGHTBOX ================= */
      const lightbox = document.getElementById("lightbox");
      const lbImg = lightbox && lightbox.querySelector("img");
      function openLightbox(src) {
        if (!lbImg || !lightbox) return;
        lbImg.src = src;
        lightbox.classList.add("open");
        lightbox.setAttribute("aria-hidden", "false");
      }
      if (lightbox) {
        lightbox.addEventListener("click", () => {
          lightbox.classList.remove("open");
          lightbox.setAttribute("aria-hidden", "true");
        });
      }

      /* ================= FAQ DATA (bilingual) ================= */
      
          window.__CTOF_FAQ = [
  {
    key: "permis",
    q: {
      fr: "üìå Permis de s√©jour",
      it: "üìå Permesso di soggiorno",
    },
 a: {
      fr: `
        <h3>Premi√®re demande (arriv√©e en Italie avec visa)</h3>
        <ol>
          <li>Dans les <strong>8 jours ouvrables</strong> suivant votre entr√©e en Italie, retirez le kit ¬´ Permesso di soggiorno ¬ª (modulo 1 + modulo 2) dans un bureau de poste muni du service <em>Sportello Amico</em> ou via un <strong>Patronato</strong> ou la mairie.</li>
          <li>Remplissez le kit en lettres majuscules (stylo noir) et d√©posez-le √† la poste avec les documents n√©cessaires. Vous recevrez un r√©c√©piss√© qui vaut titre provisoire.</li>
          <li>La Questura vous convoquera pour empreintes digitales et photos.</li>
          <li>Suivez l‚Äô√©tat de la demande sur le <a href="https://questure.poliziadistato.it/stranieri/" target="_blank" rel="noopener">site officiel</a>.</li>
        </ol>

        <h3>Renouvellement</h3>
        <ol>
          <li>Pr√©sentez la demande <strong>au moins 60 jours avant l‚Äôexpiration</strong>.</li>
          <li>Proc√©dure identique √† la premi√®re demande (kit + poste + convocation Questura).</li>
        </ol>

        <h3>Documents n√©cessaires (g√©n√©ral)</h3>
        <ul>
          <li>Kit (modulo 1 + modulo 2) correctement rempli</li>
          <li>Marque fiscale de 16 ‚Ç¨</li>
          <li>Photocopie passeport avec visa</li>
          <li>4 photos format passeport</li>
          <li>Re√ßus de paiement des contributions (bollettini postali)</li>
          <li>Justificatifs selon le type de permis (voir ci‚Äëdessous)</li>
        </ul>

        <h3>Cas particuliers</h3>
        <ul>
          <li><strong>√âtudiants</strong> : inscription √† l‚Äôuniversit√©, re√ßu du paiement des frais d‚Äô√©tudes, preuve de ressources suffisantes, assurance maladie valide.</li>
          <li><strong>Travailleurs salari√©s</strong> : contrat de travail, d√©claration de l‚Äôemployeur, fiche de paie ou communication d‚Äôembauche (UNILAV).</li>
          <li><strong>Travailleurs autonomes</strong> : inscription √† la chambre de commerce, num√©ro de TVA (partita IVA), d√©claration de revenus ou attestations de moyens financiers.</li>
          <li><strong>Regroupement familial</strong> : preuve du lien familial, preuve de logement adapt√©, revenus suffisants de la personne qui invite.</li>
          <li><strong>Protection internationale (asile/refuge)</strong> : r√©c√©piss√© de demande d‚Äôasile et attestations d√©livr√©es par les centres d‚Äôaccueil.</li>
        </ul>

        <h3>Adresse de la Questura de Ferrara</h3>
        <p>
          Questura di Ferrara ‚Äì Ufficio Immigrazione<br/>
          Corso Ercole I d‚ÄôEste, 26 ‚Äì 44121 Ferrara<br/>
          T√©l√©phone : 0532-294311
        </p>

        <p>‚úÖ V√©rifie toujours les √©tapes actualis√©es sur le portail officiel : <a href="https://questure.poliziadistato.it/stranieri/" target="_blank" rel="noopener">Polizia di Stato ‚Äì √âtrangers</a>.</p>
      `, it: `
            
        <h3>Prima richiesta (arrivo in Italia con visto)</h3>
        <ol>
          <li>Entro <strong>8 giorni lavorativi</strong> dal tuo ingresso in Italia, ritira il kit ¬´ Permesso di soggiorno ¬ª (modulo 1 + modulo 2) presso un ufficio postale con servizio <em>Sportello Amico</em> o tramite un <strong>Patronato</strong> o il comune.</li>
          <li>Compila il kit in stampatello (penna nera) e consegnalo alle poste con i documenti richiesti. Riceverai una ricevuta che vale come titolo provvisorio.</li>
          <li>La Questura ti convocher√† per impronte digitali e foto.</li>
          <li>Segui lo stato della richiesta sul <a href="https://questure.poliziadistato.it/stranieri/" target="_blank" rel="noopener">sito ufficiale</a>.</li>
        </ol>

        <h3>Rinnovo</h3>
        <ol>
          <li>Presenta la richiesta <strong>almeno 60 giorni prima</strong> della scadenza.</li>
          <li>Procedura identica alla prima richiesta (kit + poste + convocazione Questura).</li>
        </ol>

        <h3>Documenti necessari (generale)</h3>
        <ul>
          <li>Kit (modulo 1 + modulo 2) compilato correttamente</li>
          <li>Marca da bollo da 16 ‚Ç¨</li>
          <li>Fotocopia del passaporto con il visto</li>
          <li>4 foto formato tessera</li>
          <li>Ricevute dei pagamenti (bollettini postali)</li>
          <li>Documenti supplementari a seconda del tipo di permesso</li>
        </ul>

        <h3>Casi particolari</h3>
        <ul>
          <li><strong>Studenti</strong>: iscrizione universitaria, ricevuta pagamento tasse, prova di risorse adeguate, assicurazione sanitaria valida.</li>
          <li><strong>Lavoratori dipendenti</strong>: contratto di lavoro, dichiarazione del datore, busta paga o comunicazione di assunzione (UNILAV).</li>
          <li><strong>Lavoratori autonomi</strong>: iscrizione alla camera di commercio, partita IVA, dichiarazioni dei redditi o attestazioni di mezzi finanziari.</li>
          <li><strong>Ricongiungimento familiare</strong>: prova del rapporto familiare, prova di alloggio adeguato, redditi sufficienti della persona che ospita.</li>
          <li><strong>Protezione internazionale</strong>: ricevuta della domanda d'asilo e certificazioni dei centri di accoglienza.</li>
        </ul>

        <h3>Indirizzo Questura di Ferrara</h3>
        <p>
          Questura di Ferrara ‚Äì Ufficio Immigrazione<br/>
          Corso Ercole I d‚ÄôEste, 26 ‚Äì 44121 Ferrara<br/>
          Telefono: 0532-294311
        </p>

        <p>‚úÖ Controlla sempre le informazioni aggiornate sul portale ufficiale: <a href="https://questure.poliziadistato.it/stranieri/" target="_blank" rel="noopener">Polizia di Stato ‚Äì Stranieri</a>.</p>
      `,
    },
  },
  {
    key: "inscriptions",
    q: {
      fr: "üè´ Inscriptions √† l‚Äôuniversit√©",
      it: "üè´ Iscrizioni all'universit√†",
    },
    a: {
      fr: `
        <h3>√âtapes pour les √©tudiants internationaux (hors UE)</h3>
        <ol>
          <li><strong>V√©rifiez votre admissibilit√©</strong> : consultez les crit√®res et les places disponibles pour chaque fili√®re.</li>
          <li><strong>Inscription pr√©alable sur Universitaly</strong> : cr√©ez un compte sur <a href="https://www.universitaly.it/" target="_blank" rel="noopener">Universitaly</a> et candidatez.</li>
          <li><strong>R√©alisation des tests</strong> : tests de langue italienne ou tests d‚Äôacc√®s (TOLC) si demand√©s.</li>
          <li><strong>Pr√©-inscription √† Unife</strong> : compl√©tez la pr√©-immatriculation en ligne apr√®s admission.</li>
          <li><strong>Obtention du visa √©tudiant</strong> : faites la demande di visto D avec la confirmation universitaire.</li>
          <li><strong>Immatriculation finale</strong> : une fois en Italie, finalisez l'inscription aupr√®s de la Segreteria Studenti.</li>
        </ol>

        <h3>Documents g√©n√©ralement requis</h3>
        <ul>
          <li>Dipl√¥me d‚Äô√©tudes secondaires ou √©quivalent ; parfois certifi√© par ENIC‚ÄëNARIC</li>
          <li>R√©sultats de tests linguistiques ou d‚Äôadmission si requis</li>
          <li>Preuve d‚Äôinscription/universit√© pour obtenir le visa</li>
          <li>Passeport, photos, preuve de ressources, assurance sant√©</li>
        </ul>

        <h3>Destinations √† l‚ÄôUniversit√† degli Studi di Ferrara</h3>
        <p>
          <strong>Rectorat (si√®ge historique)</strong> : Via Savonarola ‚Äì Palazzo Renata di Francia<br/>
          <strong>Secr√©tariat √©tudiant & administration</strong> : Via Saragat (Polo Scientifico‚ÄëTecnologico)<br/>
          <strong>Adresse l√©gale et bureaux centraux</strong> : Ex‚ÄëConvento Santa Lucia, Via Ariosto.
        </p>

        <p>Contacts Unife et bureaux mentionn√©s dans la section principale. üí° Besoin d‚Äôaide ? Contactez ASTOF.</p>
      `,
      it: `
        <h3>Passaggi per gli studenti internazionali (extra‚ÄëUE)</h3>
        <ol>
          <li><strong>Verifica l'idoneit√†</strong>: controlla i requisiti e i posti disponibili per il corso scelto.</li>
          <li><strong>Iscrizione preliminare su Universitaly</strong>: crea un account su <a href="https://www.universitaly.it/" target="_blank" rel="noopener">Universitaly</a> e candidati.</li>
          <li><strong>Test</strong>: eventuali test di lingua italiana o test d'accesso (TOLC).</li>
          <li><strong>Pre‚Äëimmatricolazione a Unife</strong>: completa la procedura online dopo l'ammissione.</li>
          <li><strong>Visto studenti</strong>: richiedi il visto D con la conferma dell'universit√†.</li>
          <li><strong>Immatricolazione finale</strong>: una volta in Italia, finalizza l'iscrizione presso la Segreteria Studenti.</li>
        </ol>

        <h3>Documenti generalmente richiesti</h3> 
        <ul>
          <li>Diploma di scuola superiore o equivalente; a volte certificato ENIC‚ÄëNARIC</li>
          <li>Eventuali risultati di test linguistici o di ammissione</li>
          <li>Prova di iscrizione/universit√† per il rilascio del visto</li>
          <li>Passaporto, foto, prova di mezzi economici, assicurazione sanitaria</li>
        </ul>

        <p>
          <strong>Rettorato (sede storica)</strong>: Via Savonarola ‚Äì Palazzo Renata di Francia<br/>
          <strong>Segreteria studenti & amministrazione</strong>: Via Saragat (Polo Scientifico‚ÄëTecnologico)<br/>
          <strong>Sede legale e uffici centrali</strong>: Ex‚ÄëConvento Santa Lucia, Via Ariosto.
        </p>

        <p>Contatti Unife e gli uffici menzionati nella sezione principale. üí° Hai bisogno di aiuto? Contatta ASTOF.</p>
      `,
    },
  },
  {
    key: "bourse",
    q: {
      fr: "üéì Bourse d‚Äô√©tudes",
      it: "üéì Borsa di studio",
    },
    a: {
      fr: `
        <h3>Proc√©dure d‚Äôobtention d‚Äôune bourse d‚Äô√©tudes via ER.GO ‚Äì Universit√© de Ferrara</h3>
        <ol>
          <li><strong>Consulte le bando annuel (a.a. 2025/2026)</strong> : disponible d√©but juillet sur le site ER.GO. N‚Äôoublie pas de v√©rifier toutes les sections : bourses, logements, restauration, mobilit√©s, etc.</li>
          <li><strong>Cr√©e ton identifiant num√©rique</strong> : SPID, CIE ou CNS. Si tu n‚Äôas pas de document d‚Äôidentit√© italien, utilise les identifiants de ton universit√© ou ceux fournis par ER.GO.</li>
          <li><strong>Pr√©pare l‚Äôattestation ISEE</strong> : indispensable pour v√©rifier ta situation √©conomique. Elle est r√©alis√©e aupr√®s d‚Äôun CAF ou en ligne.</li>
          <li><strong>Suis la proc√©dure ‚ÄúFai domanda online‚Äù</strong> : remplit le formulaire de demande avec tes donn√©es personnelles, √©conomiques, et les b√©n√©fices souhait√©s avant les d√©lais fix√©s.</li>
          <li><strong>Respecte les d√©lais selon ton statut</strong> : pour les nouveaux (matricole), date limite souvent le 1er septembre ; pour les autres √©tudiants, g√©n√©ralement jusqu‚Äôau 8 ao√ªt.</li>
          <li><strong>Perfectionne ton inscription √† Unife</strong> : une fois ta demande soumise, compl√®te ton immatriculation pour conserver l‚Äô√©ligibilit√© aux aides.</li>
          <li><strong>Consulte ton ‚ÄúDossier Utente‚Äù</strong> : c‚Äôest ta page personnelle sur ER.GO o√π tu pourras voir l‚Äô√©tat de ta demande, documents √† fournir, et communications officielles.</li>
        </ol>

        <h3>Montants indicatifs et services ER.GO ‚Äì Ferrara</h3>
        <ul>
          <li>Les bourses couvrent jusqu‚Äô√† 100 % des frais universitaires et remboursent la taxe r√©gionale (~140 ‚Ç¨).</li>
          <li>Montants selon le statut (2025/2026) :
            <br>‚Ä¢ Fuori sede : ‚âà 7 072 ‚Ç¨
            <br>‚Ä¢ Pendolari : ‚âà 4 133 ‚Ç¨
            <br>‚Ä¢ In sede : ‚âà 2 850 ‚Ç¨
            <br>Majoration de +15 % si ISEE ‚â§ 12 500 ‚Ç¨, ou +20 % pour fili√®res STEM ou double inscription.</li>
          <li>√Ä Ferrara, ER.GO dispose d‚Äôenviron 357 places en r√©sidence universitaire, renforc√©e par des conventions locales.</li>
        </ul>

        <h3>Contacts utiles pour ER.GO ‚Äì Ferrara</h3>
        <p>
          <strong>URP (Ufficio Relazioni con il Pubblico)</strong><br/>
          Via Ariosto 35, 44121 Ferrara<br/>
          T√©l. : 051 19907580 ou 051 0185268<br/>
          Email : direzione@er-go.it ‚Ä¢ PEC : info@postacert.er-go.it<br/>
          Horaires :
          <br/>‚Äì du 16 novembre au 14 juillet : lundi/mardi/jeudi 10h‚Äë12h30 & lundi/mercredi 14h‚Äë16h
          <br/>‚Äì du 15 juillet au 15 novembre : lundi au jeudi 10h‚Äë12h30 et autres horaires adapt√©s.
        </p>

        <p>
          <strong>Career Service ‚Äì ER.GO Ferrara</strong><br/>
          Polo Scientifico Tecnologico, Via Saragat 1, Blocco B, 44122 Ferrara<br/>
          Email : orientamento.ferrara@er-go.it<br/>
          Conseillers disponibles : Paola Fagioli, Gioacchino Leonardi, Omar Paolucci.
        </p>

        <p>‚Ñπ Le nouveau bando 2025/2026 est en ligne. Prends le temps de le consulter et de respecter les d√©lais !</p>
        <p>üí° Besoin d‚Äôaide pour savoir comment d√©marrer, conna√Ætre les d√©lais, ou pr√©parer les documents ? Contactez ASTOF!</p>
      `,
      it: `
        <h3>Procedura per ottenere una borsa di studio tramite ER.GO ‚Äì Universit√† di Ferrara</h3>
        <ol>
          <li><strong>Consulta il bando annuale (a.a. 2025/2026)</strong>: disponibile all'inizio di luglio sul sito di ER.GO. Ricontrolla tutte le sezioni: borse, alloggi, ristorazione, mobilit√†, ecc.</li>
          <li><strong>Crea le tue credenziali digitali</strong>: SPID, CIE o CNS. Se non disponi di un documento d‚Äôidentit√† italiano, utilizza le credenziali fornite dalla tua universit√† o quelle indicate da ER.GO.</li>
          <li><strong>Prepara l‚Äôattestazione ISEE</strong>: indispensabile per valutare la situazione economica. Si ottiene tramite un CAF o online.</li>
          <li><strong>Segui la procedura ‚ÄúFai domanda online‚Äù</strong>: compila il modulo di domanda con i tuoi dati personali ed economici e le prestazioni richieste, rispettando i termini indicati nel bando.</li>
          <li><strong>Rispetta le scadenze secondo il tuo status</strong>: per i nuovi iscritti (matricole) il termine spesso √® il 1¬∞ settembre; per gli altri studenti solitamente entro l'8 agosto.</li>
          <li><strong>Completa l‚Äôimmatricolazione a Unife</strong>: una volta inoltrata la domanda, completa l‚Äôimmatricolazione per mantenere l‚Äôammissibilit√† alle agevolazioni.</li>
          <li><strong>Controlla il tuo ‚ÄúDossier Utente‚Äù</strong>: √® la tua pagina personale su ER.GO dove puoi verificare lo stato della domanda, i documenti richiesti e le comunicazioni ufficiali.</li>
        </ol>

        <h3>Importi indicativi e servizi ER.GO ‚Äì Ferrara</h3>
        <ul>
          <li>Le borse possono coprire fino al 100% delle tasse universitarie e rimborsare la tassa regionale (circa 140 ‚Ç¨).</li>
          <li>Importi indicativi per lo a.a. 2025/2026:
            <br>‚Ä¢ Fuori sede: ‚âà 7.072 ‚Ç¨
            <br>‚Ä¢ Pendolari: ‚âà 4.133 ‚Ç¨
            <br>‚Ä¢ In sede: ‚âà 2.850 ‚Ç¨
            <br>Eventuali maggiorazioni: +15% se ISEE ‚â§ 12.500 ‚Ç¨, o +20% per corsi STEM o doppia iscrizione.</li>
          <li>A Ferrara, ER.GO dispone di circa 357 posti in residenze universitarie, integrati da convenzioni locali.</li>
        </ul>

        <h3>Contatti utili per ER.GO ‚Äì Ferrara</h3>
        <p>
          <strong>URP (Ufficio Relazioni con il Pubblico)</strong><br/>
          Via Ariosto 35, 44121 Ferrara<br/>
          Tel.: 051 19907580 o 051 0185268<br/>
          Email: direzione@er-go.it ‚Ä¢ PEC: info@postacert.er-go.it<br/>
          Orari:
          <br/>‚Äì dal 16 novembre al 14 luglio: luned√¨/marted√¨/gioved√¨ 10:00‚Äì12:30 & luned√¨/mercoled√¨ 14:00‚Äì16:00
          <br/>‚Äì dal 15 luglio al 15 novembre: luned√¨‚Äìgioved√¨ 10:00‚Äì12:30 e orari adattati nelle altre giornate.
        </p>

        <p>
          <strong>Career Service ‚Äì ER.GO Ferrara</strong><br/>
          Polo Scientifico Tecnologico, Via Saragat 1, Blocco B, 44122 Ferrara<br/>
          Email: orientamento.ferrara@er-go.it<br/>
          Consulenti disponibili: Paola Fagioli, Gioacchino Leonardi, Omar Paolucci.
        </p>

        <p>‚Ñπ Il nuovo bando 2025/2026 √® online. Prenditi il tempo per consultarlo e rispettare le scadenze!</p>
        <p>üí° Hai bisogno di aiuto per iniziare, conoscere i termini o preparare i documenti? Contatta ASTOF!</p>
      `,
         },
        },
      {
  key: "logement",
  q: {
    fr: "üè† Logement",
    it: "üè† Alloggio",
  },
  a: {
    fr: `
      <h3>Logement √† Ferrara</h3>

      <h4>üë©‚Äçüéì Pour les √©tudiants</h4>
      <ul>
        <li><strong>R√©sidences universitaires ER.GO</strong> ‚Äì via concours ou Borsino Alloggi : <a href="https://www.er-go.it" target="_blank" rel="noopener">er-go.it</a></li>
        <li><strong>Appartements ACER Ferrara</strong> (partenariat avec ER.GO) : <a href="https://www.acerferrara.it" target="_blank" rel="noopener">acerferrara.it</a></li>
        <li><strong>R√©sidences priv√©es</strong> : 
          <a href="https://www.unispaceferrara.com" target="_blank" rel="noopener">UniSpace Ferrara</a>, 
          <a href="https://www.fondazionezanotti.org" target="_blank" rel="noopener">Fondazione Zanotti</a>
        </li>
        <li><strong>Bourse ‚ÄúHelp Affitto‚Äù</strong> ‚Äì aide au loyer pour √©tudiants de l‚ÄôUniversit√© de Ferrara : <a href="https://www.unife.it" target="_blank" rel="noopener">unife.it</a></li>
      </ul>

      <h4>üë∑ Pour les travailleurs et nouveaux arrivants</h4>
      <ul>
        <li><strong>Agences immobili√®res locales</strong> :
          <ul>
            <li><a href="https://www.tecnocasa.it/agenzie-immobiliari/ferrara.html" target="_blank" rel="noopener">Tecnocasa Ferrara</a></li>
            <li><a href="https://www.casa.it/affitto/residenziale/ferrara/" target="_blank" rel="noopener">Casa.it ‚Äì Ferrara</a></li>
            <li><a href="https://www.immobiliare.it/affitto-case/ferrara/" target="_blank" rel="noopener">Immobiliare.it ‚Äì Ferrara</a></li>
            <li><a href="https://www.subito.it/annunci-emilia-romagna/affitto/ferrara/" target="_blank" rel="noopener">Subito.it</a></li>
          </ul>
        </li>
        <li><strong>Locations entre particuliers</strong> ‚Äì consulter les groupes Facebook : 
          <em>‚ÄúAffitti studenti e lavoratori Ferrara‚Äù</em>.
        </li>
      </ul>

      <h4>üìç Contacts utiles</h4>
      <p>
        <strong>ER.GO Ferrara</strong> : Via Darsena 81/a ‚Äì R√©sidence Darsena<br/>
        <strong>ACER Ferrara</strong> : Via Arginone 326 ‚Äì T√©l. 0532 230311<br/>
        <strong>Universit√© de Ferrara ‚Äì Ufficio Housing</strong> : 
        <a href="https://www.unife.it/it/studiare/vivere-unife/alloggi" target="_blank" rel="noopener">Page logement Unife</a>
      </p>

      <p>üí° Conseil : commencez la recherche t√¥t (juin‚Äìjuillet pour septembre). Les r√©sidences ER.GO sont tr√®s demand√©es, sinon privil√©giez les agences immobili√®res locales.</p>
    `,
    it: `
      <h3>Alloggi a Ferrara</h3>

      <h4>üë©‚Äçüéì Per gli studenti</h4>
      <ul>
        <li><strong>Residenze universitarie ER.GO</strong> ‚Äì tramite concorso o Borsino Alloggi: <a href="https://www.er-go.it" target="_blank" rel="noopener">er-go.it</a></li>
        <li><strong>Appartamenti ACER Ferrara</strong> (in convenzione con ER.GO): <a href="https://www.acerferrara.it" target="_blank" rel="noopener">acerferrara.it</a></li>
        <li><strong>Residenze private</strong>:
          <a href="https://www.unispaceferrara.com" target="_blank" rel="noopener">UniSpace Ferrara</a>,
          <a href="https://www.fondazionezanotti.org" target="_blank" rel="noopener">Fondazione Zanotti</a>
        </li>
        <li><strong>Borsa "Help Affitto"</strong> ‚Äì contributo per il canone di locazione per gli studenti dell‚ÄôUniversit√† di Ferrara: <a href="https://www.unife.it" target="_blank" rel="noopener">unife.it</a></li>
      </ul>

      <h4>üë∑ Per i lavoratori e i nuovi arrivati</h4>
      <ul>
        <li><strong>Agenzie immobiliari locali</strong>:
          <ul>
            <li><a href="https://www.tecnocasa.it/agenzie-immobiliari/ferrara.html" target="_blank" rel="noopener">Tecnocasa Ferrara</a></li>
            <li><a href="https://www.casa.it/affitto/residenziale/ferrara/" target="_blank" rel="noopener">Casa.it ‚Äì Ferrara</a></li>
            <li><a href="https://www.immobiliare.it/affitto-case/ferrara/" target="_blank" rel="noopener">Immobiliare.it ‚Äì Ferrara</a></li>
            <li><a href="https://www.subito.it/annunci-emilia-romagna/affitto/ferrara/" target="_blank" rel="noopener">Subito.it</a></li>
          </ul>
        </li>
        <li><strong>Affitti tra privati</strong> ‚Äì consultare i gruppi Facebook:
          <em>‚ÄúAffitti studenti e lavoratori Ferrara‚Äù</em>.
        </li>
      </ul>

      <h4>üìç Contatti utili</h4>
      <p>
        <strong>ER.GO Ferrara</strong>: Via Darsena 81/a ‚Äì Residenza Darsena<br/>
        <strong>ACER Ferrara</strong>: Via Arginone 326 ‚Äì Tel. 0532 230311<br/>
        <strong>Universit√† di Ferrara ‚Äì Ufficio Housing</strong>:
        <a href="https://www.unife.it/it/studiare/vivere-unife/alloggi" target="_blank" rel="noopener">Pagina alloggi Unife</a>
      </p>

      <p>üí° Consiglio: iniziate la ricerca per tempo (giugno‚Äìluglio per settembre). Le residenze ER.GO sono molto richieste; in alternativa privilegiate le agenzie immobiliari locali.</p>
    `,

    },
  },

        

        // ... other FAQ entries omitted here for brevity (kept in original)
       ];

      /* ================= UI / Interaction (nav, language, filters) ================= */
      const burgerEl = document.getElementById("burger");
      const mainNav = document.getElementById("mainNav");
      if (burgerEl && mainNav) {
        burgerEl.addEventListener("click", () => {
          if (
            getComputedStyle(mainNav).display === "none" ||
            mainNav.style.display === "none"
          ) {
            mainNav.style.display = "flex";
          } else mainNav.style.display = "none";
        });
        window.addEventListener("resize", () => {
          if (window.innerWidth > 880) mainNav.style.display = "flex";
        });
      }

      function applyLang(lang) {
        if (!lang) lang = "fr";
        localStorage.setItem("ctof_lang", lang);
        store.lang = lang;
        saveStore(store);

        document.querySelectorAll("[data-key]").forEach((el) => {
          const key = el.getAttribute("data-key");
          if (translations[lang] && translations[lang][key]) {
            el.textContent = translations[lang][key];
          } else {
            const explicit = el.getAttribute("data-" + lang);
            if (explicit) el.textContent = explicit;
          }
        });

        document.querySelectorAll("[data-fr], [data-it]").forEach((el) => {
          if (el.hasAttribute("data-key")) return;
          const explicit = el.getAttribute("data-" + lang);
          if (explicit) el.textContent = explicit;
        });

        const headerEl = document.getElementById("headerSubtitle");
        if (headerEl) {
          if (store.header_subtitle && store.header_subtitle[lang]) {
            headerEl.textContent = store.header_subtitle[lang];
          } else if (translations[lang] && translations[lang].header_subtitle) {
            headerEl.textContent = translations[lang].header_subtitle;
          }
        }

        renderDocs();
        renderEvents();
        renderFAQ(lang);
        // re-render galleries with possible language changes
        renderGallery();

        // update FAQ toggle label when language changes
        const toggleBtn = document.getElementById("toggle-faq");
        if (toggleBtn) {
          const label =
            toggleBtn.getAttribute("data-" + (store.lang || "fr")) ||
            (store.lang === "it" ? "üìñ Visualizza le FAQ" : "üìñ Voir les FAQ");
          // keep arrow if previously opened
          const open = !document.getElementById("faq").classList.contains("hidden");
          toggleBtn.textContent = open ? label + " ‚ñ≤" : label;
        }
      }

      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => applyLang(btn.dataset.lang));
      });

      /* Filters setup */
      document.querySelectorAll(".filters .btn").forEach((btn) => {
        btn.addEventListener("click", () =>
          renderEvents(btn.dataset.filter || "all")
        );
      });

      /* initial render and ensure UI is consistent */
    
       // minimal normalization in case gallery contains legacy string URLs
      if (!Array.isArray(store.gallery)) store.gallery = [];
      store.gallery = (store.gallery || [])
        .map((g) => {
          if (!g) return null;
          if (typeof g === "string") {
            return {
              id: Date.now() + "-" + Math.random().toString(36).slice(2, 8),
              url: g,
              title: "",
              year: null,
              is_favorite: false,
              created_at: new Date().toISOString(),
            };
          }
          if (!g.id)
            g.id = Date.now() + "-" + Math.random().toString(36).slice(2, 8);
          if (!g.created_at) g.created_at = new Date().toISOString();
          return g;
        })
        .filter(Boolean);
      saveStore(store);

      // default selection: current year if present
      const availableYears = getUniqueYears();
      const thisYear = String(new Date().getFullYear());
      if (availableYears.includes(thisYear)) gallerySelectedYear = thisYear;
      else gallerySelectedYear = null;
      renderGallery();
      renderDocs();
      renderEvents();
      renderFAQ(store.lang || "fr");

      // set initial toggle-faq label according to language
      const toggleFaq = document.getElementById("toggle-faq");
      if (toggleFaq) {
        toggleFaq.textContent =
          toggleFaq.getAttribute("data-" + (store.lang || "fr")) ||
          (store.lang === "it" ? "üìñ Visualizza le FAQ" : "üìñ Voir les FAQ");
      }

      /* Save store on unload to be safe */
      window.addEventListener("beforeunload", () => saveStore(store));
    </script>
  </body>
</html>